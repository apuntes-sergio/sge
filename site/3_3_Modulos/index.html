
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Desarrollando máodulos en Odoo">
      
      
      
        <link rel="canonical" href="https://sergio-apuntes.github.io/sge/3_3_Modulos/">
      
      
        <link rel="prev" href="../3_2_PrimerModulo/">
      
      
        <link rel="next" href="../4_1_EjemploCreacionModeloBasico/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>3.3. Los módulos en Odoo - Apuntes Sistemas de Gestión Empresarial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#los-modulos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Apuntes Sistemas de Gestión Empresarial" class="md-header__button md-logo" aria-label="Apuntes Sistemas de Gestión Empresarial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apuntes Sistemas de Gestión Empresarial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3.3. Los módulos en Odoo
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Apuntes Sistemas de Gestión Empresarial" class="md-nav__button md-logo" aria-label="Apuntes Sistemas de Gestión Empresarial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Apuntes Sistemas de Gestión Empresarial
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1 ERP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            1 ERP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción a Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_2_IntroduccionERP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2. Introducción a la Gestión Empresarial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_3_IT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3. Informática en la Gestión Empresarial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_4_ERP_CRM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4. ERP-CRM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_5_ERP_actuales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5. Revisión de ERPs Actuales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_6_ERP_Libres_Privativos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6. ERPs Propietarios vs ERPs de Código Abierto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_7_CRM_Actuales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7. CRM Actual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_8_Terminolog%C3%ADa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8. Terminología ERP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2 Instalacion de Odoo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            2 Instalacion de Odoo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_1_InstalarOdoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1. Instalación de Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_2_InstalarDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2. Instalación con docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_3_InstalarUbuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3. Instalación en Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3 Desarrollo con odoo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            3 Desarrollo con odoo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_1_ArquitecturaOdoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1. Arquitectura de Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_2_PrimerModulo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2. Primer módulo en Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3.3. Los módulos en Odoo
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3.3. Los módulos en Odoo
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#los-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Los módulos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Los módulos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composicion-de-un-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Composición de un módulo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estructura-de-archivos-de-un-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura de archivos de un módulo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de módulos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orm" class="md-nav__link">
    <span class="md-ellipsis">
      ORM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspeccionar-los-modelos" class="md-nav__link">
    <span class="md-ellipsis">
      Inspeccionar los modelos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    <span class="md-ellipsis">
      Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#campos-normales" class="md-nav__link">
    <span class="md-ellipsis">
      Campos normales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#campos-relacionales" class="md-nav__link">
    <span class="md-ellipsis">
      Campos relacionales
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Campos relacionales">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2one" class="md-nav__link">
    <span class="md-ellipsis">
      Many2one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one2many" class="md-nav__link">
    <span class="md-ellipsis">
      One2many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2many" class="md-nav__link">
    <span class="md-ellipsis">
      Many2many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    <span class="md-ellipsis">
      Related
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2onereference" class="md-nav__link">
    <span class="md-ellipsis">
      Many2oneReference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one2one" class="md-nav__link">
    <span class="md-ellipsis">
      One2one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtros-domains" class="md-nav__link">
    <span class="md-ellipsis">
      Filtros (Domains)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields-computed" class="md-nav__link">
    <span class="md-ellipsis">
      Fields Computed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields Computed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buscar-y-escribir-en-campos-computed" class="md-nav__link">
    <span class="md-ellipsis">
      Buscar y escribir en campos computed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#valores-por-defecto" class="md-nav__link">
    <span class="md-ellipsis">
      Valores por defecto
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restricciones-constrains" class="md-nav__link">
    <span class="md-ellipsis">
      Restricciones (constrains)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archivos-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Archivos de datos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Archivos de datos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identificadores-externos-external-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Identificadores Externos (External Ids)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expresiones" class="md-nav__link">
    <span class="md-ellipsis">
      Expresiones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datos-para-campos-binary-e-image" class="md-nav__link">
    <span class="md-ellipsis">
      Datos para campos Binary e Image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eliminar-registros" class="md-nav__link">
    <span class="md-ellipsis">
      Eliminar registros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acciones-y-menus" class="md-nav__link">
    <span class="md-ellipsis">
      Acciones y menús
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Acciones y menús">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acciones-tipo-window" class="md-nav__link">
    <span class="md-ellipsis">
      Acciones tipo window
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-vista" class="md-nav__link">
    <span class="md-ellipsis">
      La vista
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#herencia" class="md-nav__link">
    <span class="md-ellipsis">
      Herència
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Herència">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#herencia-en-el-model" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en el Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#herencia-en-la-vista" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en la vista
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#herencia-en-el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en el controlador
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      El controlador
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El controlador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-de-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      API de l\'ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API de l\'ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Set operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programacio-funcional-en-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      Programació funcional en l\'ORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enviroment" class="md-nav__link">
    <span class="md-ellipsis">
      Enviroment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enviroment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metodes-de-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      Mètodes de l\'ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mètodes de l\'ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search" class="md-nav__link">
    <span class="md-ellipsis">
      search()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      create()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    <span class="md-ellipsis">
      write()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#browse" class="md-nav__link">
    <span class="md-ellipsis">
      browse()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ref" class="md-nav__link">
    <span class="md-ellipsis">
      ref()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure_one" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_one()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unlink" class="md-nav__link">
    <span class="md-ellipsis">
      unlink()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onchange" class="md-nav__link">
    <span class="md-ellipsis">
      onchange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Cron Jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#els-decoradors" class="md-nav__link">
    <span class="md-ellipsis">
      Els Decoradors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculs-en-dates" class="md-nav__link">
    <span class="md-ellipsis">
      Càlculs en dates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4 Desarrollo de un módulo de gestión de proyectos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            4 Desarrollo de un módulo de gestión de proyectos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_1_EjemploCreacionModeloBasico/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1. Creación de un modelo básico, vistas, menús y actions.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_2_EjemploCamposBasicos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2. Campos básicos y relacionales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_3_EjemploCamposComputados/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3. Campos básicos computados.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_4_EjemploExcepcionesMensajes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4. Lanzar excepciones y añadir mensajes de log.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_5_EjemploCamposComputadosRelacionales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.5. Campos computados relacionales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_6_EjemploCamposValoresDefecto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.6. Campos con valores por defecto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_7_EjemploHerencias/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.7. Herencias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_8_EjemploMejorandoVistas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.8. Mejorando vistas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_9_EjemploDatosDemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.9. Datos de demostración
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#los-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Los módulos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Los módulos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composicion-de-un-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Composición de un módulo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estructura-de-archivos-de-un-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura de archivos de un módulo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de módulos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orm" class="md-nav__link">
    <span class="md-ellipsis">
      ORM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inspeccionar-los-modelos" class="md-nav__link">
    <span class="md-ellipsis">
      Inspeccionar los modelos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    <span class="md-ellipsis">
      Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#campos-normales" class="md-nav__link">
    <span class="md-ellipsis">
      Campos normales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#campos-relacionales" class="md-nav__link">
    <span class="md-ellipsis">
      Campos relacionales
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Campos relacionales">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2one" class="md-nav__link">
    <span class="md-ellipsis">
      Many2one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one2many" class="md-nav__link">
    <span class="md-ellipsis">
      One2many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2many" class="md-nav__link">
    <span class="md-ellipsis">
      Many2many
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    <span class="md-ellipsis">
      Related
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many2onereference" class="md-nav__link">
    <span class="md-ellipsis">
      Many2oneReference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one2one" class="md-nav__link">
    <span class="md-ellipsis">
      One2one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtros-domains" class="md-nav__link">
    <span class="md-ellipsis">
      Filtros (Domains)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields-computed" class="md-nav__link">
    <span class="md-ellipsis">
      Fields Computed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields Computed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buscar-y-escribir-en-campos-computed" class="md-nav__link">
    <span class="md-ellipsis">
      Buscar y escribir en campos computed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#valores-por-defecto" class="md-nav__link">
    <span class="md-ellipsis">
      Valores por defecto
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restricciones-constrains" class="md-nav__link">
    <span class="md-ellipsis">
      Restricciones (constrains)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#archivos-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      Archivos de datos
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Archivos de datos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identificadores-externos-external-ids" class="md-nav__link">
    <span class="md-ellipsis">
      Identificadores Externos (External Ids)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expresiones" class="md-nav__link">
    <span class="md-ellipsis">
      Expresiones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datos-para-campos-binary-e-image" class="md-nav__link">
    <span class="md-ellipsis">
      Datos para campos Binary e Image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eliminar-registros" class="md-nav__link">
    <span class="md-ellipsis">
      Eliminar registros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acciones-y-menus" class="md-nav__link">
    <span class="md-ellipsis">
      Acciones y menús
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Acciones y menús">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acciones-tipo-window" class="md-nav__link">
    <span class="md-ellipsis">
      Acciones tipo window
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#la-vista" class="md-nav__link">
    <span class="md-ellipsis">
      La vista
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#herencia" class="md-nav__link">
    <span class="md-ellipsis">
      Herència
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Herència">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#herencia-en-el-model" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en el Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#herencia-en-la-vista" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en la vista
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#herencia-en-el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      Herència en el controlador
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-controlador" class="md-nav__link">
    <span class="md-ellipsis">
      El controlador
    </span>
  </a>
  
    <nav class="md-nav" aria-label="El controlador">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-de-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      API de l\'ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API de l\'ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Set operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programacio-funcional-en-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      Programació funcional en l\'ORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enviroment" class="md-nav__link">
    <span class="md-ellipsis">
      Enviroment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enviroment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metodes-de-lorm" class="md-nav__link">
    <span class="md-ellipsis">
      Mètodes de l\'ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mètodes de l\'ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search" class="md-nav__link">
    <span class="md-ellipsis">
      search()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      create()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write" class="md-nav__link">
    <span class="md-ellipsis">
      write()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#browse" class="md-nav__link">
    <span class="md-ellipsis">
      browse()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ref" class="md-nav__link">
    <span class="md-ellipsis">
      ref()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure_one" class="md-nav__link">
    <span class="md-ellipsis">
      ensure_one()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unlink" class="md-nav__link">
    <span class="md-ellipsis">
      unlink()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onchange" class="md-nav__link">
    <span class="md-ellipsis">
      onchange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Cron Jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#els-decoradors" class="md-nav__link">
    <span class="md-ellipsis">
      Els Decoradors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculs-en-dates" class="md-nav__link">
    <span class="md-ellipsis">
      Càlculs en dates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>3.3. Los módulos en Odoo</h1>

<p>Hemos hecho una introducción creando unos módulos de prueba en Odoo. Ahora vamos a profundizar y explicar qué es cada uno de los elementos y cómo se utilizar, al menos con una profundidad mínima para poder desarrollar módulos básicos.</p>
<h2 id="los-modulos">Los módulos</h2>
<p>Tanto el servidor como los clientes son módulos. Todos están guardados en una base de datos. Todo lo que se pueda hacer para modificar <strong><em>Odoo</em></strong> se hace en módulos.</p>
<h3 id="composicion-de-un-modulo">Composición de un módulo</h3>
<p>Los módulos de <strong><em>Odoo</em></strong> amplían o modifican partes del <em>Modelo-Vista-Controlador</em>. De esta manera, un módulo puede tener:</p>
<ul>
<li><strong>Objetos de negocio</strong>: Son la parte del modelo, definidos en clases de Python según una sintaxis propia del ORM de <strong><em>Odoo</em></strong>.</li>
<li><strong>Archivos de datos</strong>: Son archivos XML que pueden definir datos, vistas o configuraciones.</li>
<li><strong>Controladores web</strong>: Gestionan las peticiones de los navegadores web.</li>
<li><strong>Datos estáticos</strong>: Imágenes, CSS o JavaScript utilizados por la interfaz web. Es necesario que los datos estáticos se guarden en el directorio <strong>static</strong>. Por ejemplo, el icono del módulo va en <code>static/description/icon.png</code>.</li>
</ul>
<h3 id="estructura-de-archivos-de-un-modulo">Estructura de archivos de un módulo</h3>
<p>Ya vimos en la sección anterior alguna de las características de los módulos: </p>
<ul>
<li>Todos los módulos están en un directorio definido en la opción <strong>--addons-path</strong> o en el archivo de configuración, normalmente <code>addons</code>. Cada módulo esta un un subdirectorio dentro de esta carpeta y por lo que puede haber más de un directorio.</li>
<li>Un módulo de Python se declara en un archivo de <strong>manifest</strong> (<code>__manigest__.py</code>) que da información sobre el módulo, lo que hace, los módulos de los que depende y cómo se debe instalar o actualizar. <a href="https://www.odoo.com/documentation/8.0/reference/module.html#reference-module-manifest">Manifest in Odoo</a></li>
<li>Un módulo es un paquete de Python que necesita un archivo <strong>__init__.py</strong> para instanciar todos los archivos Python.</li>
</ul>
<h3 id="creacion-de-modulos">Creación de módulos</h3>
<p>También hemos visto que podemos crear un módulo de forma manual añadiendo cada una de las carpetas y ficheros de configuración o vimos que para ayudar al programador, <strong><em>Odoo</em></strong> contiene le comando <code>scaffold</code> para crear módulos vacíos. Este crea la estructura de archivos necesaria para empezar a trabajar:</p>
<div class="language-text highlight"><pre><span></span><code>$ odoo scaffold &lt;nombre_del_módulo&gt; &lt;dónde_crearlo&gt;
</code></pre></div>
<p>Posteriormente veremos más sobre <code>scaffold</code>, pero si quieres más información puedes recurrir al <a href="https://www.odoo.com/documentation/8.0/reference/cmdline.html#scaffolding">Manual oficial Scaffolding</a></p>
<p>El parámetro <strong>scaffold</strong> puede tener la opción <strong>-t</strong> para indicar el directorio de la <em>plantilla</em>. Esta está hecha utilizando <strong>jinja2</strong>, que es un motor de plantillas para Python.</p>
<p>Las <em>plantillas</em> están en el directorio de instalación de Odoo, en el directorio <strong>cli</strong>. En nuestro caso: <strong>cli/templates/</strong> dentro del directorio de instalación de <strong><em>Odoo</em></strong>.</p>
<figure align="center">
  <a class="glightbox" href="../imgs/desarrollo/Odoo_Templates.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/desarrollo/Odoo_Templates.png" width="75%" /></a>
  <figcaption>Plantillas de módulos Odoo utilizadas por `scaffold`.</figcaption>
</figure>
<p>Como podemos observar, el ejemplo de la sección anterior *HolaMundo_V3" tiene exactamente esta estructura.</p>
<p>Podemos crear una nueva <em>plantilla</em> copiando el directorio <code>default</code> o <code>theme</code> y modificando los archivos. Esto puede ser útil si siempre hacemos módulos con la misma plantilla. Por ejemplo, para poner nuestro logo, copyright, etc.</p>
<h2 id="orm">ORM</h2>
<p>El <strong>ORM</strong> ("<em>Object-Relational Mapping</em>" o "<em>Mapeo Objeto-Relacional</em>") es una técnica de programación que permite convertir datos entre sistemas incompatibles utilizando lenguajes de programación orientados a objetos. En <strong><em>Odoo</em></strong>, el <strong>ORM</strong> permite a los desarrolladores trabajar con la base de datos de manera más intuitiva y eficiente, sin necesidad de escribir consultas SQL directamente.</p>
<p>El <strong>ORM</strong> es como una capa de abstracción que mapea las tablas de la base de datos a clases de Python y las filas de esas tablas a instancias de esas clases. Esto significa que puedes manipular los datos de la base de datos utilizando objetos y métodos de Python, lo que simplifica enormemente el desarrollo y mantenimiento del código.</p>
<figure align="center">
  <a class="glightbox" href="../imgs/desarrollo/Odooarch.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/desarrollo/Odooarch.png" width="75%" /></a>
  <figcaption>ORM dentro de la arquitectura de Odoo.</figcaption>
</figure>
<p>Con ORM en Odoo se puede 
- <strong>Definición de modelos</strong>: Puedes definir modelos de datos utilizando clases de Python. Cada modelo corresponde a una tabla en la base de datos.
- <strong>Operaciones CRUD</strong>: El ORM proporciona métodos para realizar operaciones CRUD (Crear, Leer, Actualizar, Eliminar) de manera sencilla. Por ejemplo, puedes crear un nuevo registro utilizando el método <code>create()</code>, leer registros con el método <code>search()</code>, actualizar registros con el método <code>write()</code>, y eliminar registros con el método <code>unlink()</code>.
- <strong>Relaciones entre modelos</strong>: Puedes definir relaciones entre modelos, como relaciones uno a muchos, muchos a uno, y muchos a muchos, utilizando campos específicos como <code>One2many</code>, <code>Many2one</code>, y <code>Many2many</code>.
- <strong>Validaciones y restricciones</strong>: Puedes definir validaciones y restricciones en los modelos para asegurar la integridad de los datos. Por ejemplo, puedes utilizar el decorador <code>@api.constrains</code> para definir restricciones personalizadas.</p>
<p>A continuación se muestra un <strong>ejemplo</strong> sencillo de cómo definir un modelo en <strong><em>Odoo</em></strong> utilizando el <strong>ORM</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">class</span> <span class="nc">ModeloEjemplo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;modelo.ejemplo&#39;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Descripción de modelo de ejemplo&#39;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Nombre&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">descripcion</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Descripción&#39;</span><span class="p">)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">fecha</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="k">def</span> <span class="nf">_check_nombre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>       <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>             <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;El nombre debe tener al menos 3 caracteres.&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>En este ejemplo:</p>
<ul>
<li>Definimos un modelo llamado <code>ModeloEjemplo</code> que corresponde a una tabla en la base de datos.</li>
<li>El modelo tiene tres campos: <code>nombre</code>, <code>descripcion</code>, y <code>fecha</code>.</li>
<li>Utilizamos el decorador <code>@api.constrains</code> para definir una restricción que asegura que el campo <code>nombre</code> tenga al menos 3 caracteres.</li>
</ul>
<p>Mediante <strong>ORM</strong>, <strong><em>Odoo</em></strong> mapea sus objetos en una base de datos, evitando al programador la mayoría de consultas SQL. De esta manera, el desarrollo de los módulos es muy rápido y se evitan errores de programación.</p>
<p>Los modelos se crean como clases de Python que extienden la clase <strong><a href="https://www.odoo.com/documentation/master/developer/reference/backend/orm.html">models.Model</a></strong>, que contiene los campos y métodos útiles para trabajar con el ORM.</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Los modelos, al heredar de <strong>models.Model</strong>, necesitan obligatoriamente asignar valores a algunas variables, como por ejemplo <strong>_name</strong>.</p>
</div>
<p><strong><em>Odoo</em></strong> considera que un modelo es la referencia a una o más tablas en la base de datos. Un modelo no es una fila en la tabla, es toda la tabla.</p>
<blockquote>
<p>En programación, el <strong>Modelo</strong> es una forma de relacionar el programa con la base de datos. Es de más alto nivel que las consultas directas a la base de datos y que las <strong>clases y objetos</strong> respecto a la programación orientada a objetos. El modelo une en un único concepto las <strong>estructuras de datos</strong>, las <strong>restricciones de integridad</strong> y las opciones de <strong>manipulación</strong> de los datos.</p>
</blockquote>
<p>Los modelos en <strong><em>Odoo</em></strong> pueden</p>
<ul>
<li>Heredar de <strong>models.Model</strong> y ser los normales, mapeados y permanentes en la base de datos. </li>
<li>Pueden ser <strong>models.TransientModel</strong>, que son iguales pero no tienen persistencia definitiva en la base de datos. Estos son los recomendados para crear <code>wizards</code>. </li>
<li>También pueden ser <strong>models.AbstractModel</strong> para definir modelos abstractos que luego serán heredados.</li>
</ul>
<p>En Odoo, existen tres tipos principales de modelos que heredan de clases base diferentes según su propósito, se trata de <code>models.Model</code>, <code>models.TransientModel</code> y <code>models.AbstractModel</code>:</p>
<ul>
<li><code>models.Model</code> se trata de Modelos persistentes. Representa una tabla real en la base de datos. Los datos almacenados en este modelo son permanentes. Por ejemplo Clientes, productos, facturas, etc.</li>
<li><code>models.TransientModel</code> son datos temporales (como asistentes o formularios rápidos), por lo tanto es un modelo no persistente. Los registros se eliminan automáticamente después de un tiempo (por defecto, 7 días). Se utilizan para Wizards, asistentes de importación/exportación, formularios temporales.</li>
<li><code>models.AbstractModel</code> que son modelos base reutilizables, o sea, se trata de modelos abstractos que no crea una tabla en la base de datos. Se utiliza para definir funcionalidades comunes que pueden ser heredadas por otros modelos.</li>
</ul>
<p>Comparativa rápida</p>
<table>
<thead>
<tr>
<th>Característica</th>
<th><code>models.Model</code></th>
<th><code>models.TransientModel</code></th>
<th><code>models.AbstractModel</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Persistencia</td>
<td>Sí</td>
<td>No (temporal)</td>
<td>No</td>
</tr>
<tr>
<td>Crea tabla en BD</td>
<td>Sí</td>
<td>Sí</td>
<td>No</td>
</tr>
<tr>
<td>Uso típico</td>
<td>Datos reales</td>
<td>Formularios/Wizards</td>
<td>Funcionalidad común</td>
</tr>
<tr>
<td>Eliminación automática</td>
<td>No</td>
<td>Sí</td>
<td>No</td>
</tr>
</tbody>
</table>
<h2 id="inspeccionar-los-modelos">Inspeccionar los modelos</h2>
<p>Para ver los modelos existentes, se puede acceder a la base de datos PostgreSQL o consultar en <em>Configuración &gt; Estructura de la base de datos &gt; Modelos</em> dentro del modo desarrollador.</p>
<p>Cabe destacar el campo <em>modules</em>, donde se indican los módulos instalados en los que se define o hereda el modelo observado.</p>
<h2 id="fields">Fields</h2>
<p>Las "columnas" del modelo son los fields (campos). Estos pueden ser de datos normales como Integer, Float, Boolean, Date, Char... o especiales como Many2one, One2many, Related...</p>
<p>Hay algunos fields reservados:</p>
<ul>
<li><strong>id</strong> (Id): identificador único para un registro en su modelo.</li>
<li><strong>create_date</strong> (Datetime): fecha de creación del registro.</li>
<li><strong>create_uid</strong> (Many2one): usuario que creó el registro.</li>
<li><strong>write_date</strong> (Datetime): fecha de la última modificación del registro.</li>
<li><strong>write_uid</strong> (Many2one): usuario que realizó la última modificación.</li>
</ul>
<p>Hay otros fields que podemos declarar y que tienen propiedades especiales. Estos son los más importantes:</p>
<ul>
<li><strong>name</strong>: es el campo utilizado para el <strong>Identificador Externo</strong> o cuando se hace referencia en los many2one en la vista.</li>
<li><strong>active</strong>: indica si el registro está activo. Permite ocultar productos que ya no se necesitan, por ejemplo.</li>
<li><strong>sequence</strong>: permite definir el orden de los registros a mostrar en una lista.</li>
</ul>
<p>Los fields se declaran con un constructor:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model2&#39;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</span></code></pre></div>
<p>Tienen unos atributos comunes:</p>
<ul>
<li><strong>string</strong> (unicode, por defecto: el nombre del field): la etiqueta que verán los usuarios en la vista.</li>
<li><strong>required</strong> (bool, por defecto: False): si es <em>True</em>, el campo no puede quedar vacío.</li>
<li><strong>help</strong> (unicode, por defecto: ''): en los formularios proporciona ayuda al usuario para rellenar el campo.</li>
<li><strong>index</strong> (bool, por defecto: False): pide a <strong><em>Odoo</em></strong> que sea el índice de la base de datos. En otro caso, el ORM crea un campo <strong>id</strong>.</li>
</ul>
<p>Y algunos, sobre todo los especiales, tienen atributos particulares.</p>
<p>Ejemplo completo:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span> <span class="nc">AModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;a_name&#39;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>       <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>                   <span class="c1"># Etiqueta opcional del campo</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>       <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_name_custom&quot;</span><span class="p">,</span>  <span class="c1"># Convierte el campo en calculado</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>       <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                      <span class="c1"># Si es calculado, almacena el resultado</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>       <span class="n">select</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                     <span class="c1"># Fuerza índice en el campo</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>       <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                   <span class="c1"># El campo será solo lectura en las vistas</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>       <span class="n">inverse</span><span class="o">=</span><span class="s2">&quot;_write_name&quot;</span><span class="p">,</span>           <span class="c1"># Al actualizar, dispara esta función</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>       <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                   <span class="c1"># Campo obligatorio</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>       <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  <span class="c1"># Habilita traducción</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;blabla&#39;</span><span class="p">,</span>                   <span class="c1"># Texto de ayuda</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>       <span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>          <span class="c1"># Convierte columnas a ir.property</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>       <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_function&#39;</span><span class="p">,</span>       <span class="c1"># Búsqueda personalizada, usado sobre todo con compute</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>       <span class="n">copy</span><span class="o">=</span><span class="kc">True</span>                        <span class="c1"># Si se puede copiar con el método copy()</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="p">)</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="c1"># La clave string no es obligatoria</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="c1"># Por defecto usará el nombre de la propiedad capitalizado</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>  <span class="c1"># Definición válida</span>
</span></code></pre></div>
<p>Si queremos <strong>valores por defecto</strong>, se pueden indicar como un atributo del field.</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Alberto&#39;</span><span class="p">)</span>
</span></code></pre></div>
o
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">a_fun</span><span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="o">...</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">def</span> <span class="nf">a_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
</span></code></pre></div></p>
<h3 id="campos-normales">Campos normales</h3>
<p>Estos son los campos para datos normales que proporciona Odoo:</p>
<ul>
<li><code>Integer</code></li>
<li><code>Char</code></li>
<li><code>Text</code></li>
<li><code>Date</code>: Muestra un calendario en la vista.</li>
<li><code>Datetime</code></li>
<li><code>Float</code></li>
<li><code>Boolean</code></li>
<li><code>Html</code>: Guarda un texto, pero se representa de manera especial en el cliente.</li>
<li><code>Binary</code>: Para guardar, por ejemplo, imágenes. Utiliza codificación base64 al enviar los archivos al cliente. En realidad los guarda en <strong>/var/lib/odoo/.local/share/Odoo/filestore</strong> y la ruta a los archivos la indica la tabla <strong>ir_attachment</strong> junto con el id, nombre del campo y el modelo.</li>
<li><code>Image</code> (Odoo13): En el caso de imágenes, acepta los atributos <strong>max_width</strong> y <strong>max_height</strong> donde se puede indicar en píxeles que debe redimensionar la imagen a ese tamaño máximo.</li>
<li>Sele`ction: Muestra un select con las opciones indicadas.</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">type</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;Básico&#39;</span><span class="p">),(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;Intermedio&#39;</span><span class="p">),(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;Completado&#39;</span><span class="p">)])</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">aselection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s1">&#39;a_function_name&#39;</span><span class="p">)</span> <span class="c1"># Se puede llamar a una función que define las opciones.</span>
</span></code></pre></div>
<h3 id="campos-relacionales">Campos relacionales</h3>
<p>Las relaciones entre los modelos (en definitiva, entre las tablas de la base de datos) también las simplifica el <strong>ORM</strong>. Así, las relaciones 1 a muchos se hacen en lo que Odoo llama <strong><em>Many2one</em></strong> y las relaciones Muchos a Muchos se hacen con <strong><em>Many2many</em></strong>. Las relaciones muchos a muchos, en una base de datos relacional, implican una tercera tabla intermedia, pero en Odoo no tenemos que preocuparnos de estos detalles si no queremos, el mapeo de los objetos lo detectará y creará las tablas, claves y restricciones de integridad necesarias. Vamos a repasar uno a uno estos campos:</p>
<h4 id="reference">Reference</h4>
<p>Una referencia arbitraria a un modelo y un campo.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">([(</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span><span class="p">)])</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span><span class="p">)])</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s1">&#39;a_function_name&#39;</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># Fragmento de test_new_api:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">reference</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Documento relacionado&#39;</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;_reference_models&#39;</span><span class="p">)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">def</span> <span class="nf">_reference_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">)])</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ir.&#39;</span><span class="p">)]</span>
</span></code></pre></div>
<p>Los campos reference no son muy utilizados, ya que normalmente las relaciones entre modelos son siempre las mismas.</p>
<h4 id="many2one">Many2one</h4>
<p>Relación con otro modelo</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">arel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">arel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">an_other_rel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">delegate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<p>En este caso:</p>
<div class="language-text highlight"><pre><span></span><code>----------              -----------
| País   |  uno         |  Ciudad | 
---------- -----        -----------
| * id   |     |        | * id    |
| * name |     | muchos | * name  |
----------     ---------| * país  |
                        -----------
</code></pre></div>
<p>El código resultante sería:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">class</span> <span class="nc">ciudad</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;mon.ciutat&#39;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">pais</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s2">&quot;mon.pais&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;País&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;restrict&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>delegate</strong> está en True para hacer que los campos del modelo apuntado sean accesibles desde el modelo actual.</p>
<p>También acepta <strong>context</strong> y <strong>domain</strong> como en la vista. Así queda disponible para todas las posibles vistas.</p>
<p>Otro argumento adicional es <strong>ondelete</strong> que permite definir el comportamiento al borrar el elemento referenciado: <strong>set null</strong>, <strong>restrict</strong> o <strong>cascade</strong>.</p>
<blockquote>
<p><code>ondelete cascade</code> borra los hijos a nivel de PostgreSQL, pero no elimina en External Id, eso se hace en unlink(), pero no ejecuta unlink() de los hijos. Por tanto, si queremos que se eliminen por completo, hay que heredar el unlink del padre y añadir la llamada al de los hijos.</p>
</blockquote>
<h4 id="one2many">One2many</h4>
<p>Inversa del Many2one. Necesita la existencia de un Many2one en el otro modelo:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="s1">&#39;arel_id&#39;</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">inverse_name</span><span class="o">=</span><span class="s1">&#39;arel_id&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>Un One2many funciona porque hay un many2one en el otro modelo. Así, siempre hay que especificar el nombre del modelo y el nombre del campo Many2one del modelo que hace referencia al actual, como se puede ver en el ejemplo.</p>
<p>En el ejemplo anterior, quedaría así:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">class</span> <span class="nc">pais</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;mon.pais&#39;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">ciudades</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;mon.ciutat&#39;</span><span class="p">,</span> <span class="s1">&#39;pais&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Ciudades&#39;</span><span class="p">)</span>
</span></code></pre></div>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Es importante entender que el <strong>One2many</strong> no implica datos adicionales en la base de datos y siempre es calculado como un ''select'' en la base de datos donde el id del modelo actual coincida con el <strong>Many2one</strong> (clave foránea) del otro modelo. Esto hace que no tenga sentido hacer <em>One2many</em> computed o poner un domain para restringir los que se pueden añadir.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Los <em>One2many</em> pueden tener domain para no mostrar los que no cumplen una condición, esto no significa que no exista esa relación.</p>
</div>
<h4 id="many2many">Many2many</h4>
<p>Relación muchos a muchos.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="c1"># El modelo con el que se relaciona</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;table_name&#39;</span><span class="p">,</span> <span class="c1"># (opcional) el nombre de la tabla intermedia</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">column1</span><span class="o">=</span><span class="s1">&#39;col_name&#39;</span><span class="p">,</span> <span class="c1"># (opcional) el nombre en la tabla intermedia de la columna de este modelo</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">column2</span><span class="o">=</span><span class="s1">&#39;other_col_name&#39;</span><span class="p">)</span>  <span class="c1"># (opcional) el nombre de la columna del otro modelo.</span>
</span></code></pre></div>
<p>El primer ejemplo suele funcionar directamente, pero si queremos tener más de una relación Many2many entre los dos mismos modelos, hay que usar la sintaxis completa donde especificamos el nombre de la relación y el nombre de las columnas que identifican los dos modelos. Recuerda que una relación Many2many implica una tabla intermedia y estamos especificando sus claves foráneas.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>También es necesario especificar la tabla intermedia si se hace una relación <strong>Many2many</strong> al propio modelo.</p>
<p>Un <strong>Many2many</strong> implica una tabla intermedia. Si queremos añadir atributos a esta relación, hay que crear explícitamente el modelo intermedio.</p>
<p>El <strong>many2many</strong> puede ser ''computed'' y en el cálculo se puede ordenar o filtrar. Un Many2many computed no crea la tabla intermedia.</p>
</div>
<h4 id="related">Related</h4>
<p>Un campo de otro modelo, necesita una relación Many2one. Así se pueden aprovechar las funcionalidades de guardado, como búsquedas o referencias en funciones. En términos de bases de datos, un campo related rompe la tercera forma normal. Esto suele ser problemático, pero Odoo tiene mecanismos para que no pase nada. De todas formas, si nos preocupa esto, con store=False no guarda nada en la tabla.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">participant_nick</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Nick name&#39;</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">related</span><span class="o">=</span><span class="s1">&#39;partner_id.name&#39;</span>
</span></code></pre></div>
<p>Un campo related puede ser de cualquier tipo. Por ejemplo, many2one:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">sala</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="s1">&#39;cine.sala&#39;</span><span class="p">,</span> 
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">related</span><span class="o">=</span><span class="s1">&#39;sessio.sala&#39;</span><span class="p">,</span> 
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="many2onereference">Many2oneReference</h4>
<p>Un <strong>Many2one</strong> donde también se guarda el modelo al que hace referencia con el atributo: <strong>model_field</strong>. Más <a href="https://www.odoo.com/documentation/18.0/developer/reference/backend/orm.html#pseudo-relational-fields">info</a></p>
<h4 id="one2one">One2one</h4>
<p>Los campos <strong>One2one</strong> no existen en Odoo. Pero si queremos esta funcionalidad podemos usar varias técnicas:</p>
<ul>
<li>Hacer dos campos Many2many y restringir con constrains que solo puede existir una relación. Problemas:<ul>
<li>En la vista no podemos poner un widget como en el Many2one y es complicado evitar relaciones cruzadas.</li>
<li>Se puede poner un <strong>limit</strong> en la vista, pero seguirá comportándose como un Many2many.</li>
</ul>
</li>
<li>Hacer dos Many2one y restringir con constrains o sql constrains que solo puede existir una relación mutua. (Hay que sobreescribir los métodos create y write para que se cree la asociación automáticamente). Problemas:<ul>
<li>Si sobreescribimos el write de ambos, se puede producir una llamada recursiva sin fin y es complicado evitar referencias cruzadas.</li>
</ul>
</li>
<li>Hacer un Many2one y en el otro modelo un Many2one computed que busque en los del primer modelo. Para poder editar en ambos hay que hacer una función inversa para el campo computed. Esta es una de las opciones más elegantes. </li>
</ul>
<div class="admonition examle">
<p class="admonition-title">One2one</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">class</span> <span class="nc">orderline</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;sale.order.line&#39;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;sale.order.line&#39;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">booking</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="p">(</span><span class="s1">&#39;booking_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(booking)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ya existe otra línea de pedido para esta reserva&#39;</span><span class="p">),</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="p">]</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="k">class</span> <span class="nc">bookings</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;reserves.bookings&#39;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="n">order_line</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_order_line&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_order_line&#39;</span><span class="p">)</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="k">def</span> <span class="nf">_get_order_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>            <span class="n">b</span><span class="o">.</span><span class="n">order_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;booking.id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span><span class="o">.</span><span class="n">id</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">one</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="k">def</span> <span class="nf">_set_order_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">id</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">o</span><span class="p">)])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;booking&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
</span></code></pre></div>
</div>
<ul>
<li>Hacer un Many2one y un One2many y restringir el máximo del One2many (<a href="https://stackoverflow.com/questions/32801526/how-to-create-a-one2one-relationship-in-odoo-8">+info</a>). Problemas:<ul>
<li>Los mismos que en los dos many2many. Es más simple restringir las relaciones cruzadas.</li>
</ul>
</li>
<li>Hacer una herencia múltiple (+info](http://blog.odoobiz.com/2014/10/openerp-one2one-relational-field-example.html)). Problemas:<ul>
<li>Esta es, en teoría, la forma más oficial de hacerlo, pero obliga a crear siempre la relación y los modelos en un orden determinado.</li>
</ul>
</li>
</ul>
<h4 id="filtros-domains">Filtros (Domains)</h4>
<p>En ocasiones es necesario añadir un filtro en el código python para que un campo <strong>relacional</strong> no pueda tener ciertas referencias. El comportamiento del domain es diferente según el tipo de campo.</p>
<ul>
<li><strong>Domain en Many2one</strong>: Filtra los elementos del modelo referenciado que pueden ser elegidos para el campo:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">parent</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;game.resource&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;[(&#39;template&#39;, &#39;=&#39;, True)]&quot;</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li><strong>Domain en Many2many</strong>: La lista de elementos a elegir se filtra según el domain:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">allowed_value_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="n">comodel_name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_allowed_value_ids&quot;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">def</span> <span class="nf">_compute_allowed_value_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="n">record</span><span class="o">.</span><span class="n">allowed_value_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">value_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">comodel_name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;[(&#39;id&#39;, &#39;in&#39;, allowed_value_ids)]&quot;</span><span class="p">,</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="p">)</span>
</span></code></pre></div>
<ul>
<li><strong>Domain en One2many</strong>: Al ser una relación que depende de otro Many2one, no se puede filtrar, si ponemos un domain, solo dejará de mostrar los que no cumplen el domain, pero no dejan de existir.</li>
</ul>
<h3 id="fields-computed">Fields Computed</h3>
<p>Muchas veces queremos que el contenido de un campo sea calculado en el momento en que lo vamos a visualizar. Todos los tipos de campos pueden ser <em>computed</em> (calculados). Veamos algunos ejemplos:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Este campo no se guarda en la base de datos </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1"># y siempre se recalcula cuando ejecutamos una acción que lo muestra</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Plazas ocupadas&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_taken_seats&#39;</span><span class="p">)</span>   
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1"># El decorador @api.depends() indica que se llamará a la función </span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="c1"># siempre que se modifiquen los campos seats y attendee_ids. </span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># Si no lo ponemos, solo se recalcula al recargar la acción.</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>  
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>          
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="c1"># El for recorre self, que es un recordset con todos los elementos del modelo mostrados </span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="c1"># por la vista. Si es un tree, serán todos los visibles y si es un form, será un singleton.</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>  
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>        <span class="c1"># r es un singleton y se puede acceder a los campos como variables del objeto.      </span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span><span class="p">:</span> 
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>            <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span> 
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>            <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
</span></code></pre></div>
</div>
<p>En este ejemplo se ve cómo el campo <em>float</em> <code>taken_seats</code> se calcula en una función privada <code>_taken_seats</code>. Es interesante observar el <em>for</em> porque recorre todas las instancias a las que hace referencia el modelo. Esta función solo se ejecutará una vez aunque tenga que calcular todos los elementos de una lista. Por eso, la propia función es la que debe iterar los elementos de <strong>self</strong>. <strong>self</strong> es un <code>recordset</code>, es decir, es como una lista en la que cada elemento es un registro del modelo. Si el campo <em>computed</em> se llama al entrar en un formulario, el recordset tendrá solo un elemento, pero si el campo <em>computed</em> se ve en una lista (tree), puede que sean varios registros. Es importante recordar hacer el <strong>for record in self:</strong> aunque pensemos que el campo <em>computed</em> solo lo utilizaremos en un formulario.</p>
<p>:</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo de campos <strong>computed</strong> de todos los tipos</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">tools</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="k">class</span> <span class="nc">pruebas_computed</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;pruebas_computed.pruebas_computed&#39;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Imagen original&quot;</span><span class="p">)</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="n">computedfloat</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">computedchar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="n">medium_image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_redimensionar&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="n">small_image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_redimensionar&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="n">computedm2o</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="n">computedm2m</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;product.template&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>    <span class="n">computeddate</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="n">computeddatetime</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="k">def</span> <span class="nf">_value_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computedfloat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span> 
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computedchar</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computedm2o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">id</span> <span class="c1"># Many2one espera un id, que es un campo Integer. </span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[93m&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;product.product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">)</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computedm2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;product.template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">ids</span> <span class="c1"># Many2many espera un array de ids o un recordset. </span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>            <span class="c1"># El código comentado a continuación hace lo mismo, por si queremos hacer otras cosas dentro del for.</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>            <span class="c1"># ids = []</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>            <span class="c1"># for t in self.env[&#39;product.template&#39;].search([(&#39;id&#39;,&#39;&gt;&#39;,r.value)]):</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>            <span class="c1">#     ids.append(t.id)</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>            <span class="c1"># r.computedm2m = ids</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>            <span class="c1"># r.computeddate = date.today() # Esto depende de Python</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computeddate</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="c1"># Recomendamos este, ya que es propio de la clase fields de Odoo</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>            <span class="c1"># r.computeddate = datetime.now()</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>            <span class="n">r</span><span class="o">.</span><span class="n">computeddatetime</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>    <span class="k">def</span> <span class="nf">_redimensionar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>            <span class="n">image_original</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">image</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>            <span class="k">if</span> <span class="n">image_original</span><span class="p">:</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>                <span class="n">images</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_get_resized_images</span><span class="p">(</span><span class="n">image_original</span><span class="p">)</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>                <span class="n">r</span><span class="o">.</span><span class="n">medium_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_medium&#39;</span><span class="p">]</span>                        
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>                <span class="n">r</span><span class="o">.</span><span class="n">small_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_small&#39;</span><span class="p">]</span>                
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>                <span class="n">r</span><span class="o">.</span><span class="n">medium_image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                        
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a>                <span class="n">r</span><span class="o">.</span><span class="n">small_image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span></code></pre></div>
<p>(<a href="https://github.com/xxjcaxx/SGE-Odoo-2016-2017/tree/master/proves_computed">Código completo</a>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>En el apartado del <code>controlador</code> se explican más detalles de las funciones en python-odoo.</p>
</div>
<h4 id="buscar-y-escribir-en-campos-computed">Buscar y escribir en campos computed</h4>
<p>Con <strong>api.depends</strong> podemos hacer que los campos calculados puedan ser buscados o referenciados desde otros modelos, ya que podemos indicar que sí se guarden en la base de datos. Si se guarda en la base de datos, no se recalcula hasta que no cambia el contenido del <em>field</em> del que depende. Pero si el campo calculado no depende de valores estáticos de otros <em>fields</em> y/o necesitamos que siempre se calcule, no tenemos muchas opciones elegantes. Una de ellas puede ser hacer dos campos, uno calculado <strong>store=False</strong> y otro no, y hacer un <em>write</em> en la función. Otra posibilidad es hacer una función pública que pueda ser llamada desde otro modelo. La más elegante, aunque no siempre funciona, es utilizar la opción <strong>search</strong> y asignarle una función que debe retornar un dominio de búsqueda. El problema es que no acepta mucha complejidad, ya que supone una búsqueda por toda la base de datos y puede ser muy ineficiente.</p>
<p>Por defecto no se puede escribir en un campo <em>computed</em>. No tiene mucho sentido en la mayoría de los casos, ya que es un campo que depende de otros. Pero puede ser que, a veces, queramos escribir el resultado y que modifique el campo origen. Imaginemos, por ejemplo, que sabemos el precio final y queremos que calcule el precio sin IVA. Para hacerlo, la mejor manera es crear una función y hacer que esté en la opción <strong>inverse</strong>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">preu</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="s1">&#39;Precio&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_get_price&quot;</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_price&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_price&#39;</span><span class="p">)</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;pelicula&#39;</span><span class="p">,</span> <span class="s1">&#39;descuento&#39;</span><span class="p">)</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">def</span> <span class="nf">_get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">precio</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="p">(</span><span class="n">price</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">descuento</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>        <span class="n">r</span><span class="o">.</span><span class="n">preu</span> <span class="o">=</span> <span class="n">price</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="k">def</span> <span class="nf">_search_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="c1"># De momento este search solo es para ==</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    <span class="n">precios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">precio</span> <span class="o">-</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">precio</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">descuento</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)])</span> <span class="c1"># Un buen ejemplo de mapped en lambda</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">precios</span><span class="p">)</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">precios</span> <span class="k">if</span> <span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span>  <span class="c1"># condición if en una lista python sin hacer un for (list comprehension)</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    <span class="c1"># también se puede probar en un filter() de python</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    <span class="c1"># p es una lista de las id que ya cumplen la condición, por tanto solo hay que hacer que la id esté en la lista.</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)]</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="k">def</span> <span class="nf">_set_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">precio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preu</span>  <span class="c1"># Esto es un ejemplo, pero está mal, ya que modificas el precio de la peli en todas las sesiones</span>
</span></code></pre></div>
</div>
<p>Documentación oficial: <a href="https://www.odoo.com/documentation/master/developer/reference/backend/orm.html">https://www.odoo.com/documentation/master/developer/reference/backend/orm.html</a></p>
<h3 id="valores-por-defecto">Valores por defecto</h3>
<p>En <strong><em>Odoo</em></strong> es muy fácil definir valores por defecto, ya que es un argumento más en el constructor de los campos:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Desconocido&quot;</span><span class="p">)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">def</span> <span class="nf">compute_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="n">a_field</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">compute_default_value</span><span class="p">)</span>
</span></code></pre></div>
<p>Si queremos, por ejemplo, poner la fecha del momento de crear, no podemos hacer esto:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>  <span class="c1"># INCORRECTO</span>
</span></code></pre></div>
<p>Porque calcula la fecha en el momento de actualizar el módulo, no al crear el elemento en el modelo. Hay que hacer:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>  <span class="c1"># CORRECTO</span>
</span></code></pre></div>
<p>o</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="c1"># CORRECTO</span>
</span></code></pre></div>
<p>El valor por defecto no puede depender de un campo que se está creando en ese momento. En ese caso se puede utilizar un <strong>on_change</strong>.</p>
<p>En caso de tener muchos valores por defecto o que dependan del contexto, se puede utilizar la función <strong>default_get</strong> que ya tienen los modelos.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">def</span> <span class="nf">default_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">):</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SelectSalePrice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default_get</span><span class="p">(</span><span class="n">default_fields</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_picking_id&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;picking_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_picking_id&#39;</span><span class="p">)</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
<p>Lo que hace esta función es un poco avanzado de momento, ya que hace uso del <code>context</code> y la herencia para añadir un valor por defecto al diccionario que retorna esta función en la clase <em>Model</em>.</p>
<h3 id="restricciones-constrains">Restricciones (constrains)</h3>
<p>Los objetos pueden incorporar, de forma opcional, restricciones de integridad, adicionales a las de la base de datos. <strong><em>Odoo</em></strong> valida estas restricciones en las modificaciones de datos y, en caso de violación, muestra una pantalla de error.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;El registro es demasiado antiguo: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="c1"># todos los registros pasaron la prueba, no retornar nada</span>
</span></code></pre></div>
<p>En ocasiones, cuando tenemos claro cómo haríamos esta restricción en SQL, tal vez nos resulte más interesante hacer una restricción de base de datos con una <strong>sql constraint</strong>. Estas se definen con 3 strings <strong>(name, sql_definition, message)</strong>. Por ejemplo:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="p">(</span><span class="s1">&#39;name_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(name)&#39;</span><span class="p">,</span> <span class="s1">&#39;Mensaje de advertencia personalizado&#39;</span><span class="p">),</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="p">(</span><span class="s1">&#39;contact_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(contact)&#39;</span><span class="p">,</span> <span class="s1">&#39;Mensaje de advertencia personalizado&#39;</span><span class="p">)</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="p">]</span>
</span></code></pre></div>
<p>En este caso, se trata de una restricción de unicidad, que es más sencilla de implementar que realizar una búsqueda en Python.</p>
<h2 id="archivos-de-datos">Archivos de datos</h2>
<p>Cuando desarrollamos un módulo en Odoo, podemos definir datos que se almacenarán en la base de datos. Estos datos pueden ser necesarios para el funcionamiento del módulo, para demostración o incluso formar parte de la vista.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Algunos módulos solo existen para insertar datos en Odoo.</p>
</div>
<p>Todos los archivos de datos son en formato XML y tienen una estructura como la siguiente:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nt">&lt;odoo&gt;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;{nombre_modelo}&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;{identificador_registro}&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;{nombre_campo}&quot;</span><span class="nt">&gt;</span>{valor}<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="nt">&lt;/record&gt;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="nt">&lt;/odoo&gt;</span>
</span></code></pre></div>
<p>Dentro de las etiquetas <strong>odoo</strong> podemos encontrar una etiqueta <strong>record</strong> por cada fila de la tabla que queremos introducir. Es necesario especificar el modelo y el id. El <strong>id</strong> es un identificador externo, que no tiene por qué coincidir con la clave primaria que el ORM utilizará después. Cada <strong>field</strong> tendrá un nombre y un valor.</p>
<h3 id="identificadores-externos-external-ids">Identificadores Externos (External Ids)</h3>
<p>Todos los registros de la base de datos tienen un identificador único en su tabla, el <strong>id</strong>, que es un número autoincremental asignado por la base de datos. Sin embargo, si queremos referenciarlo en archivos de datos u otros lugares, no siempre conocemos ese id. La solución de Odoo son los <strong>Identificadores Externos</strong>. Se trata de una tabla que relaciona cada id de cada tabla con un nombre. Es el modelo <strong>ir.model.data</strong>. Para encontrarlos, accede a:</p>
<p><code>Ajustes &gt; Técnico &gt; Secuencias e identificadores &gt; Identificadores externos</code></p>
<p>Ahí encontrarás la columna <strong>Complete ID</strong>.</p>
<p>Para encontrar los <em>id</em> al crear archivos de demostración o de datos, podemos ir al menú, pero esos ids cambian de una instalación a otra. Por tanto, es recomendable utilizar los <strong>external id</strong>. Para obtenerlo, puedes activar el modo desarrollador y abrir el menú <strong>Ver metadatos</strong>.</p>
<p>En los datos de demo, los <strong>external ids</strong> se utilizan para no depender de los ids, que pueden variar al ser autoincrementales. Para que funcione, hay que usar el atributo <strong>ref</strong>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;product_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;product.product1&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Se recomienda usar el atributo <code>id</code> en el record, aunque no sobrescribe el id real, sirve para declarar el External Id y es más fácil referenciarlo después.</p>
</div>
<blockquote>
<p>Ver también la función <strong>ref()</strong> del ORM.</p>
</blockquote>
<h3 id="expresiones">Expresiones</h3>
<p>A veces queremos que los campos se calculen cada vez que se actualiza el módulo. Esto se puede hacer con el atributo <strong>eval</strong>, que evalúa una expresión de Python.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;(datetime.now()+timedelta(-1)).strftime(&#39;%Y-%m-%d&#39;)&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;product_id&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;ref(&#39;product.product1&#39;)&quot;</span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Equivalente al ejemplo anterior --&gt;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;ref(&#39;product.product1&#39;).price&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;avatar&quot;</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;school.template&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;obj().env.ref(&#39;school.template_student1&#39;).image&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Para los campos <em>x2many</em>, se puede usar eval para asignar una lista de elementos:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tag_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(6,0,[ref(&#39;vehicle_tag_leasing&#39;),ref(&#39;fleet.vehicle_tag_compact&#39;),ref(&#39;fleet.vehicle_tag_senior&#39;)])]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Observa que hemos pasado una tupla con un 6, un 0 y una lista de refs. Las tuplas pueden ser:</p>
<ul>
<li>(0, _, {'field': value}): Crea un nuevo registro y lo vincula.</li>
<li>(1, id, {'field': value}): Actualiza los valores en un registro ya vinculado.</li>
<li>(2, id, _): Desvincula y elimina el registro.</li>
<li>(3, id, _): Desvincula pero no elimina el registro de la relación.</li>
<li>(4, id, _): Vincula un registro ya existente.</li>
<li>(5, <em>, </em>): Desvincula pero no elimina todos los registros vinculados.</li>
<li>(6, _, [ids]): Reemplaza la lista de registros vinculados.</li>
</ul>
<h3 id="datos-para-campos-binary-e-image">Datos para campos Binary e Image</h3>
<p>Algunos datos como imágenes o archivos pueden incluirse en los registros. Hay dos formas:</p>
<ul>
<li>Convertir el archivo a Base64 y pegar el resultado en el campo.</li>
<li>Añadir el atributo <code>type="base64"</code> y el atributo <code>file="modulo/demo/archivo"</code>.</li>
</ul>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image_1920&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;base64&quot;</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;ejemplo/demo/caritas/1000.jpg&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Observa que la ruta parte desde el directorio del módulo.</p>
<h3 id="eliminar-registros">Eliminar registros</h3>
<p>Con la etiqueta <strong>delete</strong> se pueden especificar los elementos a eliminar usando el external ID o mediante una búsqueda:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;cine.sessio&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sessio_cine1_1&quot;</span><span class="nt">&gt;&lt;/delete&gt;</span>
</span></code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Cuidado</p>
<p>Si falla la actualización con datos de demo, es posible que Odoo desactive la posibilidad de volver a instalarlos. Esto es el campo demo de ir.module.module, que es de solo lectura, por lo que hay que modificarlo manualmente en la base de datos:</p>
<p><code>update ir_module_module set demo = 't' where name='school';</code></p>
</div>
<p>Más información: <a href="https://www.odoo.com/documentation/master/developer/reference/backend/data.html">https://www.odoo.com/documentation/master/developer/reference/backend/data.html</a></p>
<p>Aquí tienes el fragmento corregido, traducido al castellano y formateado correctamente en Markdown:</p>
<hr />
<h2 id="acciones-y-menus">Acciones y menús</h2>
<p>Si quieres conocer en más detalle cómo funcionan las acciones en Odoo, consulta el artículo <strong>Acciones y menús en Odoo</strong>.</p>
<p>El cliente web de <strong>Odoo</strong> contiene menús en la parte superior y a la izquierda. Estos menús, al ser activados, muestran otros menús y las pantallas del programa. Cuando pulsamos en un menú, la pantalla cambia porque hemos ejecutado una acción.</p>
<p>Una acción básicamente tiene:</p>
<ul>
<li><strong>type</strong>: El tipo de acción y cómo debe interpretarse. Cuando se define en XML, no es necesario especificar el tipo, ya que lo indica el modelo en el que se guarda.</li>
<li><strong>name</strong>: El nombre, que puede mostrarse o no en pantalla. Se recomienda que sea legible para humanos.</li>
</ul>
<p>Las acciones y los menús se declaran en archivos de datos XML o directamente si una función devuelve un diccionario que las define. Las acciones pueden ser llamadas de tres maneras:</p>
<ul>
<li>Haciendo clic en un menú.</li>
<li>Haciendo clic en botones de las vistas (deben estar conectados con acciones).</li>
<li>Como acciones contextuales en los objetos.</li>
</ul>
<p>De esta forma, el cliente web puede saber qué acción debe ejecutar si recibe alguna de estas cosas:</p>
<ul>
<li><strong>false</strong>: Indica que se debe cerrar el diálogo actual.</li>
<li><strong>Una cadena de texto</strong>: Con la etiqueta de la <strong>acción de cliente</strong> a ejecutar.</li>
<li><strong>Un número</strong>: Con el ID o ID externo de la acción a buscar en la base de datos.</li>
<li><strong>Un diccionario</strong>: Con la definición de la acción, que no está ni en XML ni en la base de datos. Generalmente, se utiliza para llamar a una acción al finalizar una función.</li>
</ul>
<hr />
<h3 id="acciones-tipo-window">Acciones tipo <em>window</em></h3>
<p>Las acciones de tipo <em>window</em> son registros del modelo <strong>ir.actions.act_window</strong>. Sin embargo, los menús que las llaman pueden declararse de forma más rápida mediante la etiqueta <strong>menuitem</strong>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Ideas<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="nt">&lt;/record&gt;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;menu_ideas&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;menu_root&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Ideas&quot;</span><span class="w"> </span><span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">          </span><span class="na">action=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Las acciones deben declararse en el XML antes que los menús que las utilizan.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nt">&lt;openerp&gt;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="nt">&lt;data&gt;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">        </span><span class="cm">&lt;!-- window action --&gt;</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">        </span><span class="cm">&lt;!--</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="cm">            The following tag is an action definition for a &quot;window action&quot;,</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="cm">            that is an action opening a view or a set of views</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="cm">        --&gt;</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_type&quot;</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;help&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">                </span><span class="nt">&lt;p</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;oe_view_nocontent_create&quot;</span><span class="nt">&gt;</span>Create<span class="w"> </span>the<span class="w"> </span>first<span class="w"> </span>course
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">                </span><span class="nt">&lt;/p&gt;</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">            </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">        </span><span class="cm">&lt;!-- top level menu: no parent --&gt;</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">        </span><span class="cm">&lt;!-- A first level in the left side menu is needed</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="cm">            before using action= attribute --&gt;</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;openacademy_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">                </span><span class="na">parent=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">        </span><span class="cm">&lt;!-- the following menuitem should appear *after*</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="cm">            its parent openacademy_menu and *after* its</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="cm">            action course_list_action --&gt;</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;courses_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Courses&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;openacademy_menu&quot;</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">                </span><span class="na">action=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">        </span><span class="cm">&lt;!-- Full id location:</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="cm">            action=&quot;openacademy.course_list_action&quot;</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="cm">            It is not required when it is the same module --&gt;</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">    </span><span class="nt">&lt;/data&gt;</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="nt">&lt;/openerp&gt;</span>
</span></code></pre></div>
</div>
<p>Solo el tercer nivel de menús puede tener asociada una acción. El primer nivel es el menú superior y el segundo no es "clicable".</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Lo que hemos visto en esta sección es la definición de una acción en XML como parte de la vista, pero una acción no es más que una forma cómoda de escribir muchas cosas que hará el cliente en JavaScript para pedir algo al servidor.
Las acciones separan y simplifican el desarrollo de la interfaz de usuario del cliente web. Un menú o botón en HTML activa una función JavaScript que, en principio, no sabe qué hacer. Esta solicita la definición de su acción. Una vez cargada, queda claro todo lo que debe solicitar (vistas, contexto, dominios, vistas de búsqueda, lugar donde cargarlo todo...). Entonces solicita las vistas y, con ayuda de estas y de los campos, solicita los registros que son los datos a mostrar.
Por tanto, una acción es la definición —sin programar JavaScript— de lo que debe hacer el cliente. Odoo permite declarar acciones como respuesta de funciones. Estas acciones no están en la base de datos, pero se envían igualmente al cliente, que las trata como si fueran acciones normales. Un ejemplo de esto son las acciones que devuelven los botones de los wizards. De hecho, podemos hacer que un botón devuelva una acción y, por tanto, abra una vista diferente.</p>
</div>
<h2 id="la-vista">La vista</h2>
<p>Per saber més sobre les vistes i cómo millorar-les, consulta l\'article
de <strong>La vista en Odoo</strong></p>
<h2 id="herencia">Herència</h2>
<p>El framework d\'Odoo facilita el mecanisme de l'herència per tal que els
programadors puguin adaptar mòduls existents i garantir a la vegada que
les actualitzacions dels mòduls no destrossin les adequacions
desenvolupades.</p>
<p>L'herència es pot aplicar en els tres components del patró MVC:</p>
<ul>
<li>En el model: possibilita ampliar les classes existents o dissenyar
    noves classes a partir de les existents.</li>
<li>En la vista: possibilita modificar el comportament de vistes
    existents o dissenyar noves vistes.</li>
<li>En el controlador: possibilita sobreescriure els mètodes existents o
    dissenyar-ne de nous.</li>
</ul>
<p>OpenObject proporciona tres mecanismes d'herència: l'herència de classe,
l'herència per prototip i l'herència per delegació.</p>
<table>
<thead>
<tr>
<th><strong>Mecanisme</strong></th>
<th><strong>Característiques</strong></th>
<th><strong>Com es defineix</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>De classe</strong></td>
<td>- Herència simple. <br>- La classe original queda substituïda o ampliada.  <br>- Afegeix noves funcionalitats (atributs i/o mètodes) a la classe original.  <br>- Les vistes definides sobre la classe original continuen funcionant.  <br>- Permet sobreescriure mètodes de la classe original.  <br>- En PostgreSQL, continua mapada en la mateixa taula que la classe original, ampliada amb els nous atributs que pugui incorporar.</td>
<td>- S'utilitza l'atribut <code>_inherit</code> en la definició de la nova classe Python: <code>_inherit = 'obj'</code>.  <br>- El nom de la nova classe ha de continuar sent el mateix que el de la classe original: <code>_name = 'obj'</code>.</td>
</tr>
<tr>
<td><strong>Per prototip</strong></td>
<td>- Herència simple.  <br>- Aprofita la definició de la classe original (com si fos un «prototipus»).  <br>- La classe original continua existint.  <br>- Afegeix noves funcionalitats (atributs i/o mètodes) a les aportades per la classe original.  <br>- Les vistes definides sobre la classe original no existeixen (cal dissenyar-les de nou).  <br>- Permet sobreescriure mètodes de la classe original.  <br>- En PostgreSQL, queda mapada en una nova taula.</td>
<td>- S'utilitza l'atribut <code>_inherit</code> en la definició de la nova classe Python: <code>_inherit = 'obj'</code>.  <br>- Cal indicar el nom de la nova classe: <code>_name = 'nou_nom'</code>.</td>
</tr>
<tr>
<td><strong>Per delegació</strong></td>
<td>- Herència simple o múltiple.  <br>- La nova classe «delega» certs funcionaments a altres classes que incorpora a l'interior.  <br>- Els recursos de la nova classe contenen un recurs de cada classe de la que deriven.  <br>- Les classes base continuen existint.  <br>- Afegeix les funcionalitats pròpies (atributs i/o mètodes) que correspongui.  <br>- Les vistes definides sobre les classes bases no existeixen a la nova classe.  <br>- En PostgreSQL, queda mapada en diferents taules: una taula per als atributs propis, mentre que els recursos de les classes derivades resideixen en les taules corresponents a les dites classes.</td>
<td>- S'utilitza l'atribut <code>_inherits</code> en la definició de la nova classe Python: <code>_inherits = {'obj': 'field_id'}</code>.  <br>- Cal indicar el nom de la nova classe: <code>_name = 'nou_nom'</code>.</td>
</tr>
</tbody>
</table>
<div class="language-text highlight"><pre><span></span><code>```{figure} imgs/Inheritance_methods.png
:scale: 100 %
:alt: Herència

Diferents modes d&#39;herència
```
</code></pre></div>
<h3 id="herencia-en-el-model">Herència en el Model</h3>
<p>El disseny d'un model d'Odoo heretat és paregut al disseny d'un no heretat; únicament hi ha dues diferències:</p>
<ul>
<li>Apareix l'atribut <strong>_inherit</strong> o <strong>_inherits</strong> per indicar
    l'objecte (herència simple) o els objectes (herència múltiple) dels
    quals deriva el nou objecte. La sintaxi a seguir és:</li>
</ul>
<p><code>_inherit = 'nom.objecte.del.que.es.deriva'</code>\
<code>_inherits = {'nom.objecte1':'nom_camp_FK1', ...}</code></p>
<ul>
<li>En cas d'herència simple, el nom (atribut _name) de l'objecte
    derivat pot coincidir o no amb el nom de l'objecte pare. També és
    possible no indicar l'atribut _name, fet que indica que el nou
    objecte manté el nom de l'objecte pare.</li>
</ul>
<p>L'herència simple (_inherit) amb atribut _name idèntic al de l'objecte
pare, s'anomena herència de classe i en ella el nou objecte substitueix
l'objecte pare, tot i que les vistes sobre l'objecte pare continuen
funcionant. Aquest tipus d'herència, la més habitual, s'utilitza quan es
vol afegir <em>fields</em> i/o modificar propietats de dades existents i/o
modificar el funcionament d'alguns mètodes. En cas d'afegir dades,
aquestes s'afegeixen a la taula de la base de dades en la qual estava
mapat l'objecte pare.</p>
<p><strong>Exemple d\'herència de classe</strong> L'herència de classe la trobem en
molts mòduls que afegeixen dades i mètodes a objectes ja existents, com
per exemple, el mòdul comptabilitat (account) que afegix dades i mètodes
a l'objecte res.partner. Fixem-nos en el contingut del mòdul account:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>    <span class="k">class</span> <span class="nc">res_partner</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.partner&#39;</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    <span class="n">debit_limit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="s1">&#39;Payable limit&#39;</span><span class="p">)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>Podeu comprovar que la taula res_partner d'una empresa sense el mòdul
account instal·lat no conté el camp debit_limit, que en canvi sí que hi
apareix una vegada instal·lat el mòdul.</p>
<p>Odoo té molts mòduls que deriven de l'objecte res.partner per afegir-hi
característiques i funcionalitats.</p>
<p>L'herència simple (_inherit) amb atribut <strong>_name</strong> diferent al de
l'objecte pare, s'anomena <strong>herència per prototip</strong> i en ella es crea un
nou objecte que aglutina les dades i mètodes que tenia l'objecte del
qual deriva, juntament amb les noves dades i mètodes que pugua
incorporar el nou objecte. En aquest cas, sempre es crea una nova taula
a la base de dades per mapar el nou objecte.</p>
<p><strong>Exemple d\'herència per prototip</strong> L'herència per prototip és difícil
de trobar en els mòduls que incorpora <strong><em>Odoo</em></strong>. Un exemple el tenim en el
mòdul base_calendar en el qual podem observar el mòdul comptabilitat
(account) que afegix dades i mètodes a l'objecte res.partner. Fixem-nos
en el contingut del mòdul account:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>    <span class="k">class</span> <span class="nc">res_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>    <span class="o">...</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    <span class="k">class</span> <span class="nc">calendar_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;calendar.alarm&#39;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    <span class="o">...</span>
</span></code></pre></div>
<p>En una empresa que tingui el mòdul base_calendar instal·lat podeu
comprovar l'existència de la taula res_alarm amb els camps definits a
l'apartat _atributs de la classe res_alarm i la taula calendar_alarm
amb camps idèntics als de la taula res_alarm més els camps definits a
l'apartat _atributs de la classe calendar_alarm.</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>L&#39;herència per prototip és la tradicional en els llenguatges orientats a objectes, ja que crea una nova classe vinculada
</span></code></pre></div>
L'herència múltiple (_inherits) s'anomena herència per delegació i
sempre provoca la creació d'una nova taula a la base de dades. L'objecte
derivat ha d'incloure, per cada derivació, un camp many2one apuntant
l'objecte del qual deriva, amb la propietat <strong>ondelete=\'cascade</strong>\'.
L'herència per delegació obliga que cada recurs de l'objecte derivat
apunte a un recurs de cadascun dels objectes dels quals deriva i es pot
donar el cas que hi hagi diversos recursos de l'objecte derivat que
apunten a un mateix recurs per algun dels objectes dels quals deriva.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>    <span class="k">class</span> <span class="nc">res_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>    <span class="o">...</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>    <span class="k">class</span> <span class="nc">calendar_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;calendar.alarm&#39;</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;res.alarm&#39;</span><span class="p">:</span><span class="s1">&#39;alarm_id&#39;</span><span class="p">}</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>    <span class="o">...</span>
</span></code></pre></div>
<h3 id="herencia-en-la-vista">Herència en la vista</h3>
<p>L'herència de classe possibilita continuar utilitzant les vistes
definides sobre l'objecte pare, però en moltes ocasions interessa
disposar d'una versió retocada. En aquest cas, és molt millor heretar de
les vistes existents (per afegir, modificar o eliminar camps) que
reemplaçar-les completament.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;id_xml_vista_pare&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>En cas que la vista id_xml_vista_pare estiga en un mòdul diferent del
que estem dissenyant, cal afegir el nom del mòdul al davant:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;modul.id_xml_vista_pare&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>El motor d'herència d'OpenObject, en trobar una vista heretada, processa
el contingut de l'element arch. Per cada fill d'aquest element que
tingui algun atribut, OpenObject cerca a la vista pare una etiqueta amb
atributs coincidents (excepte el de la posició) i, a continuació,
combina els camps de la vista pare amb els de la vista heretada i
estableix la posició de les noves etiquetes a partir dels següents
valors:</p>
<ul>
<li>inside (per defecte): els valors s'afegeixen "dins" de l'etiqueta.</li>
<li>after: afegeix el contingut després de l'etiqueta.</li>
<li>before: afegeix el contingut abans de l'etiqueta.</li>
<li>replace: reemplaça el contingut de l'etiqueta.</li>
<li>attributes: Modifica <a href="https://www.odoo.com/es_ES/forum/ayuda-1/question/xpath-how-to-replace-attributes-only-and-not-the-full-field-38192">els
    atributs</a>.</li>
</ul>
<p><strong>Reemplaçar</strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">   </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p><strong>Esborrar</strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p><strong>Inserir nous camps</strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="nt">/&gt;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;font-family:monospace&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="nt">/&gt;</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">    </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p><strong>Fer combinacions</strong></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">   </span><span class="nt">&lt;data&gt;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp1&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp1&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">     </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp2&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp3&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp3&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">     </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">   </span><span class="nt">&lt;/data&gt;</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p>Per definir la posició dels elements que afegim, podem utilitzar una
expresió <strong>xpath</strong>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="w"> </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;order_line&#39;]/tree/field[@name=&#39;price_unit&#39;]&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w"> </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//form/*&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">  </span><span class="nt">&lt;header&gt;</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;status&quot;</span><span class="w"> </span><span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">  </span><span class="nt">&lt;/header&gt;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w"> </span><span class="nt">&lt;/xpath&gt;</span>
</span></code></pre></div>
<p>És posssible que necessitem una vista totalment nova de l\'objecte
heredat. Si fem un action normal en l\'XML es veuran els que més
prioritat tenen. Si volem especificar quina vista volem en concret hem
d\'utilitzar <strong>view_ids</strong>, observem aquest exemple:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;terraform.player_action_window&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Players<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,kanban<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(5, 0, 0),</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;tree&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_tree&#39;)}),</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;form&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_form&#39;)}),]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</span></code></pre></div>
<p>En <strong>(0,0,{registre_a_crear})</strong> li diguem que a eixe Many2many hi ha
que afegir un nou registre amb eixes dades en concret. El que necessita
és el <strong>view_mode</strong> i el <strong>view_id</strong>, com en els records anteriors.</p>
<p>Si es vol especificar una vista search es pot inclourer la etiqueta
<strong>search_view_id</strong>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;search_view_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;cine.pos_order_line_search_view&quot;</span><span class="nt">/&gt;</span><span class="w">  </span>
</span></code></pre></div>
<p><strong>Domains</strong></p>
<p>Si volem que el action heredat sols mostre els elements que volem, s\'ha
de ficar un domain en el action:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span><span class="w"> </span>[(&#39;isplayer&#39;,&#39;=&#39;,True)]<span class="nt">&lt;/field&gt;</span><span class="w"> </span>
</span></code></pre></div>
<p>Amés, es pot dir que, per defecte, quan es crea un nou registre a través
d\'aquest action, tinga el field a True:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True}<span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p><strong>Filtre per defecte</strong></p>
<p>El problema en la solució anterior és que lleva la possibilitat de veure
el que no tenen aquest field a True i cal anar per un altre action a
modificar-los. Si volem poder veure tots, podem crear un filtre en la
vista search i en l\'action dir que volem aquest filtre per defecte:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="cm">&lt;!--   En la vista search --&gt;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>...
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="nt">&lt;search&gt;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">        </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;player_partner&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Is Player&quot;</span><span class="w"> </span><span class="na">domain=</span><span class="s">&quot;[(&#39;is_player&#39;,&#39;=&#39;,True)]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="nt">&lt;/search&gt;</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>...
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="cm">&lt;!-- En l&#39;action --&gt;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">            </span><span class="cm">&lt;!--  &lt;field name=&quot;domain&quot;&gt; [(&#39;is_player&#39;,&#39;=&#39;,True)]&lt;/field&gt; --&gt;</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;&lt;/field&gt;</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True,<span class="w"> </span>&#39;search_default_player_partner&#39;:<span class="w"> </span>1}<span class="nt">&lt;/field&gt;</span>
</span></code></pre></div>
<p>Per tant, un action complet per a vistes personalitzades i amb filtres quedarà com aquest:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;terraform.player_action_window&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Players<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,kanban<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;&lt;/field&gt;</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True,<span class="w"> </span>&#39;search_default_player_partner&#39;:<span class="w"> </span>1}<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(5, 0, 0),</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;tree&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_tree&#39;)}),</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;form&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_form&#39;)}),]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</span></code></pre></div>
<h3 id="herencia-en-el-controlador">Herència en el controlador</h3>
<p>L'herència en el controlador és un mecanisme conegut, ja que l'apliquem
de forma inconscient quan ens veiem obligats a sobreescriure els mètodes
de la capa ORM d'OpenObject en el disseny de molts mòduls.</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>Funció super()
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>El llenguatge Python recomana utilitzar la funció super() per invocar el mètode de la classe base quan s’està sobreescrivint en una classe derivada, en lloc d’utilitzar la sintaxi nomClasseBase.metode(self…).
</span></code></pre></div>
L'efecte de l'herència en el controlador es manifesta únicament quan cal
sobreescriure algun dels mètodes de l'objecte del qual es deriva i per a
fer-ho adequadament cal tenir en compte que el mètode sobreescrit en
l'objecte derivat:</p>
<ul>
<li>De vegades vol substituir el mètode de l'objecte base sense
    aprofitar-ne cap funcionalitat: el mètode de l'objecte derivat no
    invoca el mètode sobreescrit.</li>
<li>De vegades vol aprofitar la funcionalitat del mètode de l'objecte
    base: el mètode de l'objecte derivat invoca el mètode sobreescrit.</li>
</ul>
<p>Exemples:</p>
<p><a href="http://www.odoo.yenthevg.com/override-create-functions-odoo/">Sobreescriure el mètode
<strong>create</strong></a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">class</span> <span class="nc">res_partner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.partner&#39;</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>    <span class="n">passed_override_write_function</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Has passed our super method&#39;</span><span class="p">)</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>        <span class="c1"># Override the original create function for the res.partner model</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>        <span class="n">record</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">res_partner</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>        <span class="c1"># Change the values of a variable in this super function</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;passed_override_write_function&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>        <span class="nb">print</span> <span class="s1">&#39;Passed this function. passed_override_write_function value: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;passed_override_write_function&#39;</span><span class="p">])</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>        <span class="c1"># Return the record so that the changes are applied and everything is stored.</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>    <span class="k">return</span> <span class="n">record</span>
</span></code></pre></div>
<h2 id="el-controlador">El controlador</h2>
<p>Part del controlador l\'hem mencionat al parlar dels camps <strong>computed</strong>.
No obstant, cal comentar les facilitats que proporciona <strong><em>Odoo</em></strong> per a no
tindre que accedir dirèctament a la base de dades.</p>
<p>La capa <strong>ORM</strong> d'Odoo facilita uns mètodes que s'encarreguen del
mapatge entre els objectes Python i les taules de PostgreSQL. Així,
disposem de mètodes per crear, modificar, eliminar i cercar registres a
la base de dades.</p>
<p>En ocasions, pot ser necessari alterar l'acció automàtica de cerca --
creació -- modificació -- eliminació facilitada per <strong><em>Odoo</em></strong> i haurem de
sobreescriure els corresponents mètodes en les nostres classes.</p>
<p>Els programadors en el framework d\'Odoo hem de conèixer els mètodes
subministrats per la capa ORM i hem de dominar el disseny de mètodes
per:</p>
<ul>
<li>Poder definir camps funcionals en el disseny del model.</li>
<li>Poder definir l'acció que cal executar en modificar el contingut
    d'un field d'una vista form (@api.onchange)</li>
<li>Poder alterar les accions automàtiques de cerca, creació,
    modificació i eliminació de recursos.</li>
</ul>
<p>Una darrera consideració a tenir en compte en l'escriptura de mètodes i
funcions en <strong><em>Odoo</em></strong> és que els textos de missatges inclosos en mètodes i
funcions, per poder ser traduïbles, han de ser introduïts amb la sintaxi
_(\'text\') i el fitxer .py ha de contenir from tools.translate import
_ a la capçalera.</p>
<h3 id="api-de-lorm">API de l\'ORM</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>**Interactuar en la terminal**
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>    $ ***Odoo*** shell -d castillo -u containers
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>Observa cóm hem ficat el paràmetre &#39;&#39;&#39;shell&#39;&#39;&#39;. Les coses que se fan en la terminal no són persistents en la base de dades fins que no s&#39;executa &#39;&#39;&#39;self.env.cr.commit()&#39;&#39;&#39;. Dins de la terminal podem obtindre ajuda dels mètodes d&#39;Odoo amb help(), per exemple: help(tools.image)
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>Amb el següent exemple, podem arrancar ***Odoo*** sense molestar a l&#39;instància que està en marxa redefinint els ports:
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>    $ ***Odoo*** shell -c /path/to/odoo.conf --xmlrpc-port 8888 --longpolling-port 8899
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>https://asciinema.org/a/123126 (Asciinema amb alguns exemples)
</span></code></pre></div>
<p>Un mètode creat dins d\'un model actua sobre tots els elements del model
que estiguen actius en el moment de cridar al mètode. Si és un tree,
seran molts i si és un form sols un. Però en qualsevol cas és una
\'llista\' d\'elements i es diu <strong>recordset</strong>.</p>
<p>Bàsicament la interacció amb els models en el controlador es fa amb els
anomenats <strong>recordsets</strong> que són col·leccions d\'objectes sobre un
model. Si iterem dins dels recordset , obtenim els <strong>singletons</strong>, que
són objectes individuals de cada línia en la base de dades.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">def</span> <span class="nf">do_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>    <span class="nb">print</span> <span class="bp">self</span> <span class="c1"># =&gt; a.model(1, 2, 3, 4, 5)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>        <span class="nb">print</span> <span class="n">record</span> <span class="c1"># =&gt; a.model(1), then a.model(2), then a.model(3), ...</span>
</span></code></pre></div>
<p>Podem accedir a tots els fields d\'un model sempre que estem en un
singleton, no en un recordset:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">Example</span> <span class="n">Name</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">record</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="n">Company</span> <span class="n">Name</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>
</span></code></pre></div>
<p>Intentar llegir o escriure un field en un recordset donarà un error.
Accedir a un <strong>many2one, one2many o many2many</strong> donarà un recordset.</p>
<h4 id="set-operations">Set operations</h4>
<p>Els recordsets es poden combinar amb operacions específiques que són les
típiques dels conjunts:</p>
<ul>
<li><strong>record in set</strong> retorna si el record està en el set</li>
<li><strong>set1 | set2</strong> Unió de sets</li>
<li><strong>set1 &amp; set2</strong> Intersecció de sets</li>
<li><strong>set1 - set2</strong> Diferència de sets</li>
</ul>
<p>Amés, un recordset no té elements repetits i permet accedir a recordsets
dins d\'ell. Per exemple:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">record</span><span class="o">.</span><span class="n">students</span><span class="o">.</span><span class="n">classrooms</span>
</span></code></pre></div>
<p>Dona la llista de totes les classes de tots els estudiants i sense
repetir cap.</p>
<h4 id="programacio-funcional-en-lorm">Programació funcional en l\'ORM</h4>
<p>Python té una serie de funcions que permeten iterar una llista i aplicar
una funció als elements. Les més utilitzades són map(), filter(),
reduce(), sort(), zip()... <strong><em>Odoo</em></strong> treballa en recordsets, no llistes, i
té les seues funcions pròpies per a imitar aquestes:</p>
<ul>
<li><strong>filtered()</strong> Filtra el recordset de manera que sols tinga els
    records que complixen una condició.</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">company_id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">company_id</span><span class="p">)</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="s2">&quot;partner_id.is_company&quot;</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li><strong>sorted()</strong> Ordena segons uns funció, se defineix una funció lambda
    (key) que indica que s\'ordena per el camp name:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># sort records by name</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">records</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="n">records</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li><strong>mapped()</strong> Li aplica una funció a cada recordset i retorna un
    recordset amb els canvis demanats:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># returns a list of summing two fields for each record in the set</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">field1</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">field2</span><span class="p">)</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="c1"># returns a list of names</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="c1"># returns a recordset of partners</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">)</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="c1"># returns the union of all partner banks, with duplicates removed</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id.bank_ids&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>Aquestes funcions són útils per a fer tècniques de <a href="https://docs.python.org/3.7/howto/functional.html">programació
funcional</a></p>
<h4 id="enviroment">Enviroment</h4>
<p>L\'anomenat enviroment o <strong>env</strong> guarda algunes dades contextuals
interessants per a treballar amb l\'ORM, com ara el cursor a la base de
dades, l\'usuari actual o el context (que guarda algunes metadades).</p>
<p>Tots els recordsets tenen un enviroment accesible amb env. Quant volem
crear un recordset dins d\'un altre, podem usar env:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">res</span><span class="o">.</span><span class="n">partner</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([[</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">]])</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="n">res</span><span class="o">.</span><span class="n">partner</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">74</span><span class="p">)</span>
</span></code></pre></div>
<p>El primer cas crea un recordset buit però que fa referència a
res.partner i es poden fer les funcions de l\'ORM que necessitem.</p>
<h5 id="context">Context</h5>
<p>El context és un diccionari de python que conté dades útils per a totes
les vistes i els mètodes. Les funcions d\'Odoo reben el context i el
consulten si cal. Context pot tindre de tot, però quasi sempre té al
menys el user ID, l\'idioma o la zona temporal. Quant <strong><em>Odoo</em></strong> va a
renderitzar una vista XML, consulta el context per veure si ha
d\'aplicar algun paràmetre.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</span></code></pre></div>
<p>Al llarg de tot aquest manual utilitzem sovint paràmetres del context.
Aquests són els paràmetres que hem utilitzat en algun moment:</p>
<ul>
<li>active_id : self._context.get(\'active_id\') es tracta de l\'id de
    l\'element del model que està en pantalla.</li>
<li>active_ids : Llista de les id seleccionats en un tree.</li>
<li>active_model : El model actual.</li>
<li>default_<code>&lt;field&gt;</code> : En un action o en un one2many es pot
    assignar un valor per defecte a un field.</li>
<li>search_default_<code>&lt;filter&gt;</code> : Per aplicar un filtre per
    defecte a la vista en un <strong>action</strong>.</li>
<li>group_by : Dins d\'un camp <strong>filter</strong> per a crear agrupacions en les
    vistes <strong>search</strong>.</li>
<li>graph_mode : En les vistes <strong>graph</strong>, aquest paràmetre canvia el
    <strong>type</strong></li>
<li>context.get : En les vistes es pot treure algunes dades del context
    per a mostrar condicionalment o per als <em>domains</em></li>
</ul>
<p>El context va passant d\'un mètode a un altre o a les vistes i, de
vegades volem modificar-lo.</p>
<p>Imaginem que volem fer un botó que obriga un
wizard, però volem passar-li <strong>paràmetres</strong>
al wizard. En els botons i fields relacionals es pot especificar un
context:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nt">&lt;button</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;%(reserves.act_w_clients_bookings)d&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;action&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Select bookings&quot;</span><span class="w"> </span><span class="na">context=</span><span class="s">&quot;{&#39;b_fs&#39;:bookings_fs}&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<p>Eixe action obre un wizard, que és un model transitori en el que podem
definir un field amb els continguts del context:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">def</span> <span class="nf">_default_bookings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_fs&#39;</span><span class="p">)</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="n">bookings_fs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_bookings</span><span class="p">)</span>
</span></code></pre></div>
<p>Aquest many2many tindrà els mateixos elements que el form que l\'ha
cridat. (Això és com el
<strong>default_</strong> en els
One2many, però fet a mà)</p>
<p>També es pot utilitzar aquesta manera d\'enviar un recordset per un
context per al <strong>domain</strong> d\'un field Many2one o Many2many:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">def</span> <span class="nf">_domain_bookings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>         <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_fs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">)]</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="n">bookings_fs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">_default_bookings</span><span class="p">)</span>
</span></code></pre></div>
<p>En ocasions necessitem especificar valors per defecte i filtres per
defecte en un <strong>action</strong>. Per exemple, quan implementem l\'herència,
volem que els nous registres que es facen en el nostre <strong>action</strong>
tinguem un valor per defecte. En el següent exemple, en la primera línia
és el que es sol fer en la Herència i en la segona estem
especificant un External ID amb <strong>ref()</strong>
dins d\'un eval.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>        <span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;context&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="s1">&#39;default_is_player&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;search_default_player_partner&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>        <span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;context&quot;</span> <span class="nb">eval</span><span class="o">=</span><span class="s2">&quot;{&#39;default_partner_id&#39;:ref(&#39;base.main_partner&#39;), &#39;company_hide&#39;:False, &#39;default_company_id&#39;:ref(&#39;base.main_company&#39;), &#39;search_default_my_bank&#39;:1}&quot;</span><span class="o">/&gt;</span>
</span></code></pre></div>
<p>El context és un diccionari inmutable (frozendict) que no pot ser
alterat en funcions. no obstant, si volem modificar el context actual
per enviar-lo a un action o cridar a una funció d\'un model amb un altre
context, es pot fer amb
<strong><a href="https://www.odoo.com/documentation/11.0/reference/orm.html#odoo.models.Model.with_context">with_context</a></strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># current context is {&#39;key1&#39;: True}</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">({},</span> <span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="c1"># -&gt; r2._context is {&#39;key2&#39;: True}</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="c1"># -&gt; r2._context is {&#39;key1&#39;: True, &#39;key2&#39;: True}</span>
</span></code></pre></div>
<p>Si és precís modificar el context es pot fer:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span><span class="p">})</span>
</span></code></pre></div>
o</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a> <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">get_sizes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a> <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
</span></code></pre></div>
<p>Però no funciona més enllà del recordset actual. És a dir, no modifica
el context en el que s\'ha cridat.</p>
<p>Si el que volem és passar el valor d\'un field per context a un botó
dins d\'una \'subvista\', podem utilitzar el paràmetre <strong>parent</strong>, que
funciona tant en en <strong>domain</strong>, <strong>attr</strong>, com en context. Ací tenim un
exemple de tree dins d\'un field amb botons que envíen per context coses
del pare:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;movies&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">    </span><span class="nt">&lt;tree&gt;</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;photo_small&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;score&quot;</span><span class="w"> </span><span class="na">widget=</span><span class="s">&#39;priority&#39;</span><span class="nt">/&gt;</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">        </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;book_it&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Book it&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;object&quot;</span><span class="w"> </span><span class="na">context=</span><span class="s">&quot;{&#39;b_client&#39;:parent.client,&#39;b_day&#39;:parent.day}&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">     </span><span class="nt">&lt;/tree&gt;</span>
</span></code></pre></div>
<p>Podem passar el context per un action i el podem utilitzar en la vista,
ja que tenim l\'objecte <strong>context</strong> disponible en QWeb. Si, per exemple,
volem retornar un action que cride a una vista i un field tinga un
domain passat per context:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>     <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Travel wizard action&#39;</span><span class="p">,</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>            <span class="s1">&#39;res_model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>            <span class="s1">&#39;view_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>            <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="p">,</span> <span class="n">cities_available_context</span><span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cities_available</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>        <span class="p">}</span>
</span></code></pre></div>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="w">           </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;destiny&quot;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">                  </span><span class="na">domain =</span><span class="w"> </span><span class="s">&quot;[(&#39;id&#39;,&#39;in&#39;,context.get(&#39;cities_available_context&#39;,[]))]&quot;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">                  </span><span class="nt">/&gt;</span>
</span></code></pre></div>
<h4 id="metodes-de-lorm">Mètodes de l\'ORM</h4>
<h5 id="search">search()</h5>
<p>A partir d\'un <strong>domain</strong> de Odoo, proporciona un recordset amb tots els
elements que coincideixen:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="c1"># searches the current model</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="n">res</span><span class="o">.</span><span class="n">partner</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">74</span><span class="p">)</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="s1">&#39;Agrolait&#39;</span>
</span></code></pre></div>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a> Es pot obtindre la quantitat d&#39;elements amb el mètode &#39;&#39;&#39;search_count()&#39;&#39;&#39;
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="n">Parameters</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>    <span class="n">args</span> <span class="o">--</span> <span class="n">A</span> <span class="n">search</span> <span class="n">domain</span><span class="o">.</span> <span class="n">Use</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">list</span> <span class="n">to</span> <span class="n">match</span> <span class="nb">all</span> <span class="n">records</span><span class="o">.</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>    <span class="n">offset</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">--</span> <span class="n">number</span> <span class="n">of</span> <span class="n">results</span> <span class="n">to</span> <span class="n">ignore</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">none</span><span class="p">)</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>    <span class="n">limit</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">--</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">records</span> <span class="n">to</span> <span class="k">return</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="nb">all</span><span class="p">)</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>    <span class="n">order</span> <span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">--</span> <span class="n">sort</span> <span class="n">string</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>    <span class="n">count</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)</span> <span class="o">--</span> <span class="k">if</span> <span class="kc">True</span><span class="p">,</span> <span class="n">only</span> <span class="n">counts</span> <span class="ow">and</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">matching</span> <span class="n">records</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></p>
<h5 id="create">create()</h5>
<p>Te dona un recordset a partir d\'una definició de varis fields:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;New Name&quot;</span><span class="p">})</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">res</span><span class="o">.</span><span class="n">partner</span><span class="p">(</span><span class="mi">78</span><span class="p">)</span>
</span></code></pre></div>
<p>El mètode <strong>create</strong> s\'utilitza sovint per a ser sobreescrit en
herència per fer coses en el moment de la creació. Ací tenim un exemple
en el que modifiquem el <strong>create</strong> d\'un model per crear una instància
associada amb una imatge predefinida:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>     <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>     <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>        <span class="n">new_id</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>        <span class="nb">print</span> <span class="n">values</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>        <span class="n">name_player</span> <span class="o">=</span> <span class="n">new_id</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;mmog.fortress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;f1&#39;</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">icon</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;mmog.fortress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name_player</span><span class="o">+</span><span class="s2">&quot;-fortress&quot;</span><span class="p">,</span><span class="s1">&#39;level&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;soldiers&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;food&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;integrity&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;id_player&#39;</span><span class="p">:</span><span class="n">new_id</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="s1">&#39;icon&#39;</span><span class="p">:</span><span class="n">img</span><span class="p">})</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>        <span class="k">return</span> <span class="n">new_id</span>
</span></code></pre></div>
<h5 id="write">write()</h5>
<p>Escriu uns fields dins de tots els elements del recordset, no retorna
res:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Newer Name&quot;</span><span class="p">})</span>
</span></code></pre></div>
<p><strong>Escriure en un many2many</strong>:</p>
<p>La manera més senzilla és passar una llista d\'ids. Però si ja
existeixen elements abans, necessitem uns codis especials (vegeu
<a href="Odoo#Expressions" title="wikilink">Odoo#Expressions</a>):</p>
<p>Per exemple:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span> 
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;sessions&#39;</span><span class="p">:[(</span><span class="mi">4</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)]})</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;sessions&#39;</span><span class="p">:[(</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,[</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;vehicle_tag_leasing&#39;</span><span class="p">),</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;fleet.vehicle_tag_compact&#39;</span><span class="p">),</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;fleet.vehicle_tag_senior&#39;</span><span class="p">)]</span> <span class="p">)]})</span>
</span></code></pre></div>
<h5 id="browse">browse()</h5>
<p>A partir d\'una llista de ids, retorna un recordset.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="n">res</span><span class="o">.</span><span class="n">partner</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="exists">exists()</h5>
<p>Retorna si un record en concret encara està en la base de dades.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The record has been deleted&quot;</span><span class="p">)</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="n">o</span><span class="p">:</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">records</span><span class="o">.</span><span class="n">may_remove_some</span><span class="p">()</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="c1"># only keep records which were not deleted</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</span></code></pre></div>
<p>En el segon exemple, refresca un recordset amb aquells que encara
existixen.</p>
<h5 id="ref">ref()</h5>
<p>Retorna un singleton a partir d\'un <strong>External ID</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_public&#39;</span><span class="p">)</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="n">res</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="ensure_one">ensure_one()</h5>
<p>S\'asegura de que el record en concret siga un singleton.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="n">records</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="c1"># is equivalent to but clearer than:</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Expected singleton&quot;</span>
</span></code></pre></div>
<h5 id="unlink">unlink()</h5>
<p>Esborra de la base de dades els elements del recordset actual.</p>
<p>Exemple de cóm sobreescriure el mètode unlink per a esborrar en cascada:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>            <span class="n">x</span><span class="o">.</span><span class="n">catid</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">product_uom_class</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</span></code></pre></div>
<p><strong>read()</strong> Es tracta d\'un mètode de baix nivell per llegir un field en
concret dels records. És preferible emprar browse()</p>
<p><em>\'name_search(name=</em>, args=None, operator=\'ilike\', limit=100)\'\'\' →
records Search for records that have a display name matching the given
name pattern when compared with the given operator, while also matching
the optional search domain (args).</p>
<p>This is used for example to provide suggestions based on a partial value
for a relational field. Sometimes be seen as the inverse function of
name_get(), but it is not guaranteed to be.</p>
<p>This method is equivalent to calling search() with a search domain based
on display_name and then name_get() on the result of the search.</p>
<p><strong>ids</strong> Llista dels ids del recordset actual.</p>
<p><strong>sorted(key=None, reverse=False)</strong> Retorna el recordset ordenat per un
criteri.</p>
<p><strong>display_name</strong>. Aquest atribut, per defecte, mostra el field <strong>name</strong>
si està. Es pot sobreescriure <code>_compute_display_name</code> per mostrar un altre camp o mescla
d\'ells. També es pot canviar <code>_rec_name</code> per indicar un field distint de <code>name</code>.</p>
<p><strong>copy()</strong> Crea una còpia del singleton i permet aportar nous valors per
als fields de la copia.</p>
<p>En els fields <strong>One2many</strong> no es pot copiar per defecte, però es pot dir
<strong>copy=True</strong>.</p>
<h5 id="onchange">onchange</h5>
<p>Si volem que un valor siga modificat en temps real quant modifiquem el
valor d\'un altre field sense encara haver guardat, podem usar els
mètodes <strong>on_change</strong>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a> Els camps &#39;&#39;&#39;computed&#39;&#39;&#39; ja tenen el seu propi onchange, per tant, no cal fer-lo
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a> Ha quedat &quot;deprecated&quot; retornar un domain https://github.com/odoo/odoo/pull/41918#issuecomment-824946980
</span></code></pre></div>
<p>En onchange es modifica el valor d\'un o més camps dirèctament i, si cal
un filtre o un missatge, es fa en el return:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">return</span> <span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>    <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;notification&#39;</span><span class="p">},</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="p">}</span>
</span></code></pre></div>
<p>Si el <strong>type</strong> és <strong>notification</strong> es mostrarà en una notificació, en un
altre cas, en un dialog. (Odoo 13)</p>
<p>Exemples:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># onchange handler</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">)</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>    <span class="c1"># set auto-changing field</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>    <span class="c1"># Can optionally return a warning and domains</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Something bad happened&quot;</span><span class="p">,</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;It was very bad indeed&quot;</span><span class="p">,</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>        <span class="p">}</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>    <span class="p">}</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="k">def</span> <span class="nf">_verify_valid_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>         <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>             <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a>                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Incorrect &#39;seats&#39; value&quot;</span><span class="p">,</span>
</span><span id="__span-88-20"><a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a>                 <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;The number of available seats may not be negative&quot;</span><span class="p">,</span>
</span><span id="__span-88-21"><a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a>             <span class="p">},</span>          <span class="p">}</span>
</span><span id="__span-88-22"><a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
</span><span id="__span-88-23"><a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a>          <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-88-24"><a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a>             <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-25"><a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a>                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Too many attendees&quot;</span><span class="p">,</span>
</span><span id="__span-88-26"><a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a>                 <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Increase seats or remove excess attendees&quot;</span><span class="p">,</span>
</span><span id="__span-88-27"><a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a>             <span class="p">},</span>
</span><span id="__span-88-28"><a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a>         <span class="p">}</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>Si l&#39;usuari s&#39;equivoca introduint algunes dades, ***Odoo*** proporciona varies maneres d&#39;evitar-lo: 
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>* Constraints
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>* onchange amb missatge d&#39;error i restablint els valors originals
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>* Sobreescriptura del mètode write o create per comprovar coses abans de guardar 
</span></code></pre></div>
<h5 id="cron-jobs">Cron Jobs</h5>
<p>Cal crear un record en el model ir.cron, per exemple:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.cron&quot;</span><span class="w"> </span><span class="na">forcecreate=</span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;game.cron_update&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Game:<span class="w"> </span>Cron<span class="w"> </span>Update<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;model_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;model_game_player&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>code<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>model.update_resources()<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;base.user_root&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval_number&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval_type&quot;</span><span class="nt">&gt;</span>minutes<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;numbercall&quot;</span><span class="nt">&gt;</span>-1<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;activity_user_type&quot;</span><span class="nt">&gt;</span>specific<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;doall&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;False&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</span></code></pre></div>
<p>I un mètode amb el \@api.model i aquests arguments:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>    <span class="k">def</span> <span class="nf">update_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>        <span class="o">...</span>
</span></code></pre></div>
<p><strong>ir.cron</strong> té un many2one amb <strong>ir.actions.server</strong> i, al ser creat,
crea l\'acció de servidor corresponent. És important ficar en el
manifest que depén de <strong>mail</strong>, ja que és un mòdul preinstal·lat que
hereta i afegeix camps a <strong>ir.actions.server</strong>.</p>
<p><a href="https://poncesoft.blogspot.com/2018/05/creacion-metodos-automatizados-en-odoo.html">https://poncesoft.blogspot.com/2018/05/creacion-metodos-automatizados-en-odoo.html</a>
<a href="https://webkul.com/blog/creating-cron-server-action-odoo-11/">https://webkul.com/blog/creating-cron-server-action-odoo-11/</a>
<a href="https://odoo-development.readthedocs.io/en/latest/odoo/models/ir.cron.html">https://odoo-development.readthedocs.io/en/latest/odoo/models/ir.cron.html</a></p>
<h3 id="els-decoradors">Els Decoradors</h3>
<p>Com es veu, abans de moltes funcions es fica \@api.depends,
\@api.multi...</p>
<p>Els decoradors modifiquen la forma en la que és cridada la funció. Entre
altres coses, modifiquen el contingut de <strong>self</strong>, les vegades que se
crida i quant se crida.</p>
<ul>
<li><strong>\@api.depends()</strong> Aquest decorador crida a la funció sempre que el
    camp del que depén siga modificat. Encara que el camp diga
    <em>store=True</em>. Per defecte, <strong>self</strong> és un recordset, per tant, cal
    fer un for.</li>
<li><strong>\@api.model</strong> S\'utilitza per a funcions que afecten al model i no
    als recordsets.</li>
<li><strong>\@api.constrains()</strong> S\'utilitza per a comprovar les <em>constrains</em>.
    Self és un recordset. Com que quasi sempre es crida en un form,
    funciona si utilitzem self directament. Però cal fer for, ja que pot
    ser cridat en un recordset quant modifiquem camps en grup.</li>
<li><strong>\@api.onchange()</strong> S\'executa cada vegada que modifiquem el field
    indicat en la vista. En aquest, com que es crida quant es modifica
    un form, sempre <strong>self</strong> serà un singleton. Però si fiquem un for no
    passa res.</li>
</ul>
<h3 id="calculs-en-dates">Càlculs en dates</h3>
<p>Odoo gestiona les dates com a strings. Per una altra banda, python té el
seu propi tipus de dades anomenat datetime, date i timedelta entre
altres. Això pot provocar dificultats per a fer cálculs en dates. Odoo
proporciona algunes ferramentes mínimes per facilitar aquesta tasca.</p>
<p>Primer de tot, anem a importar datetime:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kn">from</span> <span class="o">***</span><span class="n">Odoo</span><span class="o">***</span> <span class="kn">import</span> <span class="nn">models</span><span class="o">,</span> <span class="nn">fields</span><span class="o">,</span> <span class="nn">api</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></code></pre></div>
<p>El primer que necessitem saber és cóm transformar de date o datetime
d'Odoo a python. En definitva, passar de string a datetime.</p>
<p>Tenim un field datetime declarat de la següent manera:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">()</span>
</span></code></pre></div>
<p>En la base de dades guardarà un string amb el format: \'%Y-%m-%d
%H:%M:%S\'. Per tant, si volem transformar aquesta data en string a un
objecte datetime.datetime tenim que ejecutar el constructor de la classe
amb aquests paràmetres:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="n">data</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span>
</span></code></pre></div>
<p>És a dir, transforma un string en aquest format al tipus de dades
datetime.datetime oficial de python.</p>
<p>Per no tindre que especificar el format cada vegada, <strong><em>Odoo</em></strong> dona una
ferramenta més facil. La classe <strong>fields.Datetime</strong> té un mètode per
generar un datetime.datetime de un string:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="n">data</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span></code></pre></div>
<p>De la mateixa manera passa al contrari:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="n">vs</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>A continuació, anem a veure cóm incrementar una data en un temps:</strong></p>
<p>En el format d'Odoo (fields.Datetime) no es pot, cal passar a
datetime.datetime per sumar el temps i després tornar a passar a
fields.Datetime. Per sumar o restar temps a un datetime.datetime cal
utilitzar una classe anomenada datetime.timedelta. Aquesta classe
representa una duració o la diferència entre dues dates. Per exemple,
aquest constructor representa molt bé les opcions que es poden ficar per
crear un timedelta:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="n">un_any</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> 
</span></code></pre></div>
<p>Aquest exemple d'Odoo mostra cóm afegir 3 dies a un field:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="n">data</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<p>O si es vol fer sols en mètodes python:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="n">data</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Ara anem a veure cóm calcular el temps que ha passat entre dues
dates:</strong></p>
<p>Solució amb <strong>relativedelta</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="n">start</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="n">end</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="n">relative</span><span class="o">=</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">years</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">months</span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">days</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="nb">print</span> <span class="n">r</span>
</span></code></pre></div>
<p>El problema és que dona la data per separat. No sol ser molt útil per a
Odoo on necessitem la diferència sols en dies, hores o minuts.</p>
<p>Solució sols amb <strong>Datetime</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="n">start</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="n">end</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="nb">print</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="nb">print</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">24</span>
</span></code></pre></div>
<p>Solució amb <strong>Unix timestamp</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="n">d1_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="n">d2_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="nb">print</span> <span class="nb">int</span><span class="p">(</span><span class="n">d2_ts</span><span class="o">-</span><span class="n">d1_ts</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
</span></code></pre></div>
<p>La solució és la mateixa, sols és per si necessiteu algun càlcul
intermedi que necessite la data en un Integer.</p>
<p>El resultat de restar dos datetime és un timedelta. Podem demanar els
dies i segons com en el relative delta, però amés té una funció per
traure els segons totals i després fer els càlculs que necessitem.</p>
<p><strong>Consultar si una data és anterior a una altra:</strong></p>
<p>Les dates en format Datetime o Date es poden comparar:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="n">d3</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d3</span><span class="p">)</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="n">d4</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="k">if</span> <span class="n">d3</span> <span class="o">&lt;</span> <span class="n">d4</span><span class="p">:</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>   <span class="nb">print</span> <span class="s2">&quot;La data és anterior&quot;</span>
</span></code></pre></div>
<p>També es pot calcular si és del mateix dia, sols cal transformar de
datetime a date:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="n">d3</span><span class="o">=</span><span class="n">d3</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="n">d4</span><span class="o">=</span><span class="n">d4</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="k">if</span> <span class="n">d3</span> <span class="o">==</span> <span class="n">d4</span> <span class="p">:</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>   <span class="err">…</span><span class="o">.</span>
</span></code></pre></div>
<p>Si volem saber si són del mateix més o any, es pot calcular la
diferència i veure si en dies és major o menor de 30, per exemple. Però
si volem major precisió, en aquest cas es recomana utilitar
relativedelta.</p>
<h2 id="misc">Misc.</h2>
<ul>
<li>Si volem fer un print en colors, podem ficar un caracter de escape:
    \033[93m i \033[0m al final</li>
<li>Traure la menor potència de 2 major o igual a un número:
    <a href="http://stackoverflow.com/a/14267557">http://stackoverflow.com/a/14267557</a></li>
</ul>
<p>Distintes alertes:</p>
<p>Odoo pot mostrar distintes alertes en funció del que necessitem. Totes
estan en openerp.exceptions</p>
<p>Si entrem en el mode shell del debug podem executar aquest comandament:</p>
<div class="language-text highlight"><pre><span></span><code>&gt;&gt;&gt; help(openerp.exceptions)
</code></pre></div>
<p>Una vegada dins podem detectar:</p>
<p><code>AccessDenied</code>\
<code>DeferredException</code>\
<code>QWebException</code>\
<code>RedirectWarning</code>\
<code>except_orm</code>\
<code>AccessError</code>\
<code>MissingError</code>\
<code>UserError</code>\
<code>ValidationError</code></p>
<p>Normalment són utilitzats pel <strong><em>Odoo</em></strong> sense necessitat de que els cridem
nosaltres. Però en ocasion pot ser útil.</p>
<p>Per exemple, si volem mostrar un Warning perquè úsuari ha fet alguna
cosa mal. (Normalment es fa un onchange que ja pot tornar el warning)</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">_</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="kn">from</span> <span class="nn">openerp.exceptions</span> <span class="kn">import</span> <span class="ne">Warning</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Alguna cosa ha fallat!&#39;</span><span class="p">))</span>
</span></code></pre></div>
<p>O si volem Donar opcions a l\'usuari amb RedirectWarning:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a> <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.action_res_users&#39;</span><span class="p">)</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a> <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;You cannot create a new user from here.</span><span class="se">\n</span><span class="s2"> To create new user please go to configuration panel.&quot;</span><span class="p">)</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a> <span class="k">raise</span> <span class="n">openerp</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RedirectWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Go to the configuration panel&#39;</span><span class="p">))</span>
</span></code></pre></div>
<p>En aquest exemple, per al missatge, utilitza la barra baixa <strong>_()</strong> per
a obtindre la traducció en cas de que existisca. <strong>self.env.ref()</strong>
retorna l\'objecte referit amb una id externa. En aquest cas, un action.</p>
<p>En el cas de les Constrains també s\'ha de llançar un Validation error.</p>
<p>Funcions lambda:</p>
<p>En moltes ocasions, cal cridar a alguna funció de l\'ORM o similar
passant com a paràmetre una funció lambda. La raó és que si passem una
variable, esta queda establerta en temps de càrrega i no es modifica. La
funció sempre recalcula.</p>
<p>La sintaxi de la funció lambda és:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="n">a</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="mi">6</span>
</span></code></pre></div>
<p>On les primeres x,y són els arguments que rep la funció, després el que
calcula.</p>
<p>Cal recordar que les funcions lambda són de una sola línia de codi. Si
volem alguna cosa més sofisticada hem de cridar a una funció normal.</p>
<p>Si volem que el nostre mòdul tinga configuració podem afegir-la com a un
field més del model <strong>res.control.settings</strong>. Aquest ja s\'encarrega de
centralitzar opcions de configuració. Per a que aparega en el menú de
configuració també podem afegir-lo heretant en la vista:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">class</span> <span class="nc">config</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.config.settings&#39;</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>    <span class="n">players</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;players&#39;</span><span class="p">,</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>                             <span class="n">config_parameter</span><span class="o">=</span><span class="s2">&quot;expanse.players&quot;</span><span class="p">)</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a>    <span class="k">def</span> <span class="nf">reset_universe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="w"> </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;res_config_settings_view_form_inherit&quot;</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>res.config.settings.view.form.<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>res.config.settings<span class="nt">&lt;/field&gt;</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;priority&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;25&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;base.res_config_settings_view_form&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">                </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//div[hasclass(&#39;settings&#39;)]&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;inside&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;app_settings_block&quot;</span><span class="w"> </span><span class="na">data-string=</span><span class="s">&quot;Expanse Settings&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Expanse Settings&quot;</span><span class="w"> </span><span class="na">data-key=</span><span class="s">&quot;expanse&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;players&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">                            </span><span class="nt">&lt;h2&gt;</span>Expanse<span class="nt">&lt;/h2&gt;</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">                            </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;object&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;reset_universe&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Reset Universe&quot;</span><span class="w">  </span><span class="na">class=</span><span class="s">&quot;btn-primary&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-109-13"><a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a>
</span><span id="__span-109-14"><a id="__codelineno-109-14" name="__codelineno-109-14" href="#__codelineno-109-14"></a><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-109-15"><a id="__codelineno-109-15" name="__codelineno-109-15" href="#__codelineno-109-15"></a><span class="w">                </span><span class="nt">&lt;/xpath&gt;</span>
</span><span id="__span-109-16"><a id="__codelineno-109-16" name="__codelineno-109-16" href="#__codelineno-109-16"></a>
</span><span id="__span-109-17"><a id="__codelineno-109-17" name="__codelineno-109-17" href="#__codelineno-109-17"></a><span class="w">            </span><span class="nt">&lt;/field&gt;</span>
</span><span id="__span-109-18"><a id="__codelineno-109-18" name="__codelineno-109-18" href="#__codelineno-109-18"></a><span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</span></code></pre></div>
<p>Si en data-key posem el nom del mòdul, afegirà l\'icona al menú de
settings.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.instant", "navigation.instant.progress", "toc.follow", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>