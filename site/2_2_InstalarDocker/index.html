
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pasos para la instalación y configuración de Odoo usando docker">
      
      
      
        <link rel="canonical" href="https://sergio-apuntes.github.io/sge/2_2_InstalarDocker/">
      
      
        <link rel="prev" href="../2_1_InstalarOdoo/">
      
      
        <link rel="next" href="../2_3_InstalarUbuntu/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>2.2. Instalación con docker - Apuntes Sistemas de Gestión Empresarial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instalar-con-docker" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Apuntes Sistemas de Gestión Empresarial" class="md-header__button md-logo" aria-label="Apuntes Sistemas de Gestión Empresarial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Apuntes Sistemas de Gestión Empresarial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.2. Instalación con docker
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Apuntes Sistemas de Gestión Empresarial" class="md-nav__button md-logo" aria-label="Apuntes Sistemas de Gestión Empresarial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Apuntes Sistemas de Gestión Empresarial
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1 ERP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            1 ERP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción a Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_2_IntroduccionERP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2. Introducción a la Gestión Empresarial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_3_IT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3. Informática en la Gestión Empresarial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_4_ERP_CRM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4. ERP-CRM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_5_ERP_actuales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5. Revisión de ERPs Actuales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_6_ERP_Libres_Privativos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6. ERPs Propietarios vs ERPs de Código Abierto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_7_CRM_Actuales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7. CRM Actual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_8_Terminolog%C3%ADa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8. Terminología ERP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2 Instalacion de Odoo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            2 Instalacion de Odoo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_1_InstalarOdoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1. Instalación de Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2.2. Instalación con docker
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2.2. Instalación con docker
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalar-un-docker-con-odoo" class="md-nav__link">
    <span class="md-ellipsis">
      Instalar un docker con Odoo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instalar un docker con Odoo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-de-modulos-de-odoo-usando-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de módulos de Odoo usando Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mejorando-la-creacion-de-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Mejorando la creación de módulos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usando-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Usando Docker Compose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usando Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activando-odoo-en-modo-desarrollador" class="md-nav__link">
    <span class="md-ellipsis">
      Activando Odoo en Modo desarrollador
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-un-nuevo-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de un nuevo módulo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#poner-en-produccion-con-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Poner en producción con Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Poner en producción con Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-de-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Docker de Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workers" class="md-nav__link">
    <span class="md-ellipsis">
      Workers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_3_InstalarUbuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3. Instalación en Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3 Desarrollo con odoo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            3 Desarrollo con odoo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_1_ArquitecturaOdoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1. Arquitectura de Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_2_PrimerModulo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2. Primer módulo en Odoo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_3_Modulos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3. Los módulos en Odoo
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4 Desarrollo de un módulo de gestión de proyectos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            4 Desarrollo de un módulo de gestión de proyectos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_1_EjemploCreacionModeloBasico/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1. Creación de un modelo básico, vistas, menús y actions.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_2_EjemploCamposBasicos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2. Campos básicos y relacionales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_3_EjemploCamposComputados/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3. Campos básicos computados.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_4_EjemploExcepcionesMensajes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4. Lanzar excepciones y añadir mensajes de log.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_5_EjemploCamposComputadosRelacionales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.5. Campos computados relacionales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_6_EjemploCamposValoresDefecto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.6. Campos con valores por defecto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_7_EjemploHerencias/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.7. Herencias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_8_EjemploMejorandoVistas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.8. Mejorando vistas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_9_EjemploDatosDemo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.9. Datos de demostración
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalar-un-docker-con-odoo" class="md-nav__link">
    <span class="md-ellipsis">
      Instalar un docker con Odoo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instalar un docker con Odoo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-de-modulos-de-odoo-usando-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de módulos de Odoo usando Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mejorando-la-creacion-de-modulos" class="md-nav__link">
    <span class="md-ellipsis">
      Mejorando la creación de módulos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usando-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Usando Docker Compose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usando Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activando-odoo-en-modo-desarrollador" class="md-nav__link">
    <span class="md-ellipsis">
      Activando Odoo en Modo desarrollador
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacion-de-un-nuevo-modulo" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de un nuevo módulo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#poner-en-produccion-con-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Poner en producción con Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Poner en producción con Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-de-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Docker de Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workers" class="md-nav__link">
    <span class="md-ellipsis">
      Workers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="instalar-con-docker">Instalar con Docker</h1>
<div class="admonition tip">
<p class="admonition-title">Revisa siempre la documentación oficial, ahí tendrás los últimos cambios</p>
<p><a href="https://registry.hub.docker.com/_/odoo/">Documentación oficial de Odoo funcionando bajo docker</a></p>
</div>
<p>Desplegar <code>Odoo</code> con Docker permite instalar y gestionar el sistema de manera más sencilla, sin necesidad de configurar manualmente dependencias o bases de datos. Docker encapsula <code>Odoo</code> en un <em>contenedor</em>, que es como una caja autosuficiente con todo lo necesario para funcionar, haciendo que sea más fácil de ejecutar en cualquier servidor u ordenador sin problemas de compatibilidad. Esto también facilita la creación de entornos de desarrollo y producción consistentes, permite actualizaciones y pruebas sin riesgo de afectar el sistema principal y optimiza el uso de recursos. Además, con Docker es posible desplegar <code>Odoo</code> junto con otros servicios necesarios, como PostgreSQL, con un solo archivo de configuración.</p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>En clase trabajaremos finalmente con Docker Compose, el texto siguiente sirve para entender la configuración final, pero no es necesario hacerlos en el trabajo diario. La configuración definitiva la haremos con Docker Compose.</p>
</div>
<h2 id="instalacion-de-docker">Instalación de <em>docker</em></h2>
<p><a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p>
<blockquote>
<p>Si queremos GUI, podemos utilizar Docker Desktop para contenedores locales o Portainer para gestionar también contenedores remotos.</p>
</blockquote>
<p>Se puede instalar Docker de muchas maneras, pero vamos a hacerlo de la manera más recomendable para nuestro caso, que es la de la web oficial:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Add Docker&#39;s official GPG key:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ca-certificates<span class="w"> </span>curl
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>sudo<span class="w"> </span>install<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>-d<span class="w"> </span>/etc/apt/keyrings
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>sudo<span class="w"> </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.asc
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>sudo<span class="w"> </span>chmod<span class="w"> </span>a+r<span class="w"> </span>/etc/apt/keyrings/docker.asc
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Add the repository to Apt sources:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="s2">  </span><span class="k">$(</span>.<span class="w"> </span>/etc/os-release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">UBUNTU_CODENAME</span><span class="k">:-</span><span class="nv">$VERSION_CODENAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># Instalación</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-buildx-plugin<span class="w"> </span>docker-compose-plugin
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># Probar docker</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Gestionar docker sin ser root:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span></code></pre></div>
<h2 id="instalar-un-docker-con-odoo">Instalar un <em>docker</em> con <code>Odoo</code></h2>
<p>En <em>Docker</em> es muy sencillo desplegar <code>Odoo</code>, aunque debemos tener en cuenta que para que Odoo funcione necesitamos tener instada la base de datos PostgreSQL. Así pues debemos:</p>
<ol>
<li>Instalamos <strong><em>PosggreSQL</em></strong> y la ponemos en marcha</li>
<li>Instalamos <strong>*Odoo</strong>, le dicemos quien es la base de datos y lo ponemos en marcha.</li>
</ol>
<p>Para hacer esto,  tan solo hace falta estos comandos:</p>
<p><strong>Primero</strong>, se inicia un docker que contenga que inicie un servicio de la base de datos <strong>PostgreSQL</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span>postgres<span class="w"> </span>--name<span class="w"> </span>db<span class="w"> </span>postgres:15
</span></code></pre></div>
<div class="admonition note">
<p>Donde: </p>
<ul>
<li>
<p><code>docker run</code>: Inicia un nuevo contenedor.</p>
</li>
<li>
<p><code>-d</code>: Ejecuta el contenedor en segundo plano (modo <em>detached</em>).</p>
</li>
<li>
<p><code>-e POSTGRES_USER=odoo</code>: Define la variable de entorno <code>POSTGRES_USER</code>, que crea un usuario llamado <code>odoo</code>.</p>
</li>
<li>
<p><code>-e POSTGRES_PASSWORD=odoo</code>: Define la contraseña del usuario <code>odoo</code>.</p>
</li>
<li>
<p><code>-e POSTGRES_DB=postgres</code>: Crea una base de datos llamada <code>postgres</code>.</p>
</li>
<li>
<p><code>--name db</code>: Asigna el nombre <code>db</code> al contenedor, lo que facilita su referencia desde otros contenedores (como el de Odoo).</p>
</li>
<li>
<p><code>postgres:15</code>: Especifica la imagen de PostgreSQL versión 15.</p>
</li>
</ul>
</div>
<p><strong>Después</strong> se inicia una instancia de <strong>Odoo</strong> utilizando la base de datos anterior</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8069</span>:8069<span class="w"> </span>--name<span class="w"> </span>odoo<span class="w"> </span>--link<span class="w"> </span>db:db<span class="w"> </span>-t<span class="w"> </span>odoo
</span></code></pre></div>
<div class="admonition note">
<p>Donde:</p>
<ul>
<li>
<p><code>docker run</code>: Inicia un nuevo contenedor a partir de una imagen.</p>
</li>
<li>
<p><code>-p 8069:8069</code>: Mapea el puerto 8069 del contenedor al puerto 8069 del host. Esto permite acceder a Odoo desde el navegador en http://localhost:8069.</p>
</li>
<li>
<p><code>--name odoo</code>: Asigna el nombre odoo al contenedor. Esto facilita su referencia en otros comandos.</p>
</li>
<li>
<p><code>--link db:db</code>: Crea un enlace entre este contenedor (odoo) y otro contenedor llamado db. El alias db:db significa que dentro del contenedor de Odoo, podrá acceder al contenedor de base de datos usando el nombre db. Observar que el alias <code>db</code> hace referencia a la base de datos iniciada anteriormente.</p>
</li>
<li>
<p><code>-t</code>: Asigna un pseudo-TTY, útil para ver la salida del contenedor en la terminal. A menudo se combina con -i (-it) para interacción.</p>
</li>
<li>
<p><code>odoo</code>: Es el nombre de la imagen de Docker que se usará para crear el contenedor. Puede ser una imagen oficial de Odoo o una personalizada</p>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Se podría iniciar tantos <strong><em>Odoo</em></strong> como se quiera cambiando el nombre del contenedor. Dos contenedores no pueden tener el mismo nombre.</p>
<p>Por ejemplo</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span>postgres<span class="w"> </span>--name<span class="w"> </span>db-demo<span class="w"> </span>postgres:latest
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8069</span>:8069<span class="w"> </span>--name<span class="w"> </span>odoo-demo<span class="w"> </span>--link<span class="w"> </span>db-demo:db<span class="w"> </span>-t<span class="w"> </span>odoo
</span></code></pre></div>
<p>Con estos comandos iniciamos contenedores llamados <strong>db-demo</strong> y <strong>odoo-demo</strong> respectivamente</p>
</div>
<p>Y para finalizar e iniciar la instancia de <strong><em>Odoo</em></strong>, si estamos dentro de la ejecución del comando que inició el docker, entonces pulsamos <strong><code>Ctrl+X</code></strong>, y si no estamos acoplados a la ejecución: </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>odoo
</span></code></pre></div>
<p>Si no estamos acoplasdos o <strong>attached</strong> podemos hacer </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>docker<span class="w"> </span>attach<span class="w"> </span>odoo
</span></code></pre></div>
<p>y veremos la salida de la ejecución del docker </p>
<p>Y para iniciar de nuevo el contenedor hacemos </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>docker<span class="w"> </span>start<span class="w"> </span>-a<span class="w"> </span>odoo
</span></code></pre></div>
<p>Si no queremos estar <em>attached</em> con la ejecución del contenedor, no ponemos la <code>-a</code></p>
<p>Recordar tambien, que podemos ejecutar haciendo </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d
</span></code></pre></div>
<p>pero en este caso, el <code>run</code> reinicializa todo frente al <code>start</code> que mantiene el estado de la última ejecución. </p>
<p>Para acceder solo hay que ir a la <strong>dirección del anfitrión:8069</strong> (<a href="http://localhost:8069">http://localhost:8069/</a>), o sea, que el servicio de <strong><em>Odoo</em></strong> es accesible a través del puerto 8069. En el comando se puede ver como se han redireccionado los puertos con <code>-p 8069:8069</code></p>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/InicioOdoo.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/InicioOdoo.png" width="75%" /></a>
  <figcaption>Primera imagen al acceder al Odoo.</figcaption>
</figure>
<h3 id="creacion-de-modulos-de-odoo-usando-docker">Creación de módulos de Odoo usando Docker</h3>
<p>Nuestro objetivo final, será el de crear módulos nuevos o heredados de los ya existente con nuestra propias necesidades.</p>
<p>El problema de esta ejecución es que si perdemos el contenedor, perdemos todo lo que hemos hecho en el. Por lo tanto la solución será enlazar carpeta locales con carpetas (o volúmenes) del contenedor, de forma que la información no se encontrará físicamente en el contenedor, si no en la carpeta que elijamos.</p>
<p>Así pues, para crear nuestros módulos podemos generarlos en un directorio fuera del contenedor y ejecutarlo de esta manera:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>odoo-data:/var/lib/odoo<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8069</span>:8069<span class="w"> </span>--name<span class="w"> </span>odoo<span class="w"> </span>--link<span class="w"> </span>db:db<span class="w"> </span>-t<span class="w"> </span>odoo
</span></code></pre></div>
<p>y lo mismo deberíamos haber hecho con el contenedor de PostgreSQL:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span>odoo-db:/var/lib/postgresql/data<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>odoo<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span>postgres<span class="w"> </span>--name<span class="w"> </span>db<span class="w"> </span>postgres:15
</span></code></pre></div>
<p>Mientras estamos desarrollando nuevos módulos, necesitaremos reiniciar el servicio y arrancarlo actualizando un módulo. Primero debemos parar el contenedor, después iniciarlo indicando que queremos entrar a la consola y finalmente actualizar el módulo.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>odoo
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>docker<span class="w"> </span>start<span class="w"> </span>-a<span class="w"> </span>odoo
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>odoo<span class="w"> </span>odoo<span class="w"> </span>--config<span class="w"> </span>/etc/odoo/odoo.conf<span class="w"> </span>-u<span class="w"> </span>nombremodulo<span class="w"> </span>-d<span class="w"> </span>nombasededatos<span class="w"> </span>-r<span class="w"> </span>odoo<span class="w"> </span>-w<span class="w"> </span>odoo<span class="w"> </span>--db_host<span class="w"> </span><span class="m">172</span>.17.0.2<span class="w"> </span>--db_port<span class="w"> </span><span class="m">5432</span>
</span></code></pre></div>
<h3 id="mejorando-la-creacion-de-modulos">Mejorando la creación de módulos</h3>
<p>Como se puede ver, el último comando es un poco complicado. Por tanto, vamos a hacerlo de forma más ordenada. Para ello necesitamos un archivo propio de configuración de <code>Odoo</code> al que llamaremos <strong>odoo.conf</strong>. Podemos utilizar esta plantilla:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>odoo<span class="w"> </span>cat<span class="w"> </span>/etc/odoo/odoo.conf<span class="w"> </span>&gt;<span class="w"> </span>odoo.conf
</span></code></pre></div>
<p>Lo que hemos hecho es copiar el archivo que tiene el contenedor por defecto. Si lo analizamos, no indica correctamente dónde está la base de datos, ya que esa información la pasamos con el parámetro <strong>--link</strong> del <strong>docker run</strong>. Nosotros tenemos que crear un directorio, poner dentro el archivo, editarlo y añadir esta información:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nx">db_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">odoo</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nx">db_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">odoo</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nx">db_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">172.17.0.2</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nx">db_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5432</span>
</span></code></pre></div>
<p>Ahora ya podemos arrancar el contenedor con todo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>odoo
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--volumes-from<span class="w"> </span>odoo<span class="w"> </span>-v<span class="w"> </span>/home/jose/modules/:/mnt/extra-addons<span class="w"> </span>-v<span class="w"> </span>/home/jose/config/:/etc/odoo<span class="w"> </span>-p<span class="w"> </span><span class="m">8069</span>:8069<span class="w"> </span>--name<span class="w"> </span>odoo2<span class="w"> </span>--link<span class="w"> </span>db:db<span class="w"> </span>-t<span class="w"> </span>odoo
</span></code></pre></div>
<p>Observamos que tenemos un directorio para nuestros módulos, otro con el archivo de configuración, la redirección del puerto, el nombre del nuevo módulo, el enlace a la base de datos y el tipo de contenedor.</p>
<p>Por último, mientras tenemos en marcha el servicio, en otra terminal podemos ejecutar:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>odoo<span class="w"> </span>odoo<span class="w"> </span>-u<span class="w"> </span>nombremodulo<span class="w"> </span>-d<span class="w"> </span>nombasededatos
</span></code></pre></div>
<p>Aun con esta mejora, no va a ser una tarea sencilla la gestión de nuestro sistema, por lo que se antoja imprescindible buscar nuevas soluciones</p>
<h2 id="usando-docker-compose">Usando <strong><code>Docker Compose</code></strong></h2>
<p>El método anterior supone la ejecución de un <strong>docker run</strong>/<strong>start</strong> muy complejo por el motivo de que se debe ejecutar cada contenedor con una única línea, y además tenemos que iniciar los servicios de uno en uno en orden. Esto es un trabajo tedioso, que se puede automatizar y además es propenso a que tengamos errores. </p>
<p>Para evitar errores, podemos usar un <a href="https://docs.docker.com/compose/">docker compose</a> que tiene una configuración como la que sigue:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">odoo</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odoo</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odoo:18.0</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8069:8069&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odoo-web-data:/var/lib/odoo</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config:/etc/odoo</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./addons:/mnt/extra-addons</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOST=db</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USER=odoo</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PASSWORD=odoo</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--dev=all</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=postgres</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER=odoo</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=odoo</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odoo-db-data:/var/lib/postgresql/data</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">  </span><span class="nt">odoo-web-data</span><span class="p">:</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">  </span><span class="nt">odoo-db-data</span><span class="p">:</span>
</span></code></pre></div>
<p>Observamos que declaramos dos servicios y que <strong>odoo</strong> depende de <strong>db</strong>. También hay que indicar qué red utilizan y el resto de datos que normalmente ponemos en el <strong>run</strong>.</p>
<p>También podemos ver que hay unas secciones de volumes donde por ejemplo, para <code>odoo</code> tenemos 3 volúmenes o carpetas que el contenedor tiene redireccionadas a carpetas locales:</p>
<ul>
<li><code>odoo-web-data</code> será un volumen en nuestra máquina que se crea de forma automática y que reemplaza la carpeta del contenedor <code>/var/lib/odoo</code></li>
<li><code>./config</code> que quiere decir tendremos una subcarpeta donde estará la configuración de odoo, en vez de estar dentro del contenedor en <code>/etc/odoo</code></li>
<li><code>./addons</code> que contienen los módulos (oficiales y los que crearemos) y lo tendremos en local en vez de en el contenedor en <code>/mnt/extra-addons</code></li>
</ul>
<p>Por otra parte, dentro de esta configuración también es interesante que hemos preparado <strong><em>Odoo</em></strong> para poder trabajar en modo <em>desarrollador</em>, esto es gracias al comando <code>--dev=all</code> que veremos posteriormente con más detalle.
Una vez vistas estas puntualizaciones, para montar el sistema: </p>
<ol>
<li>Creamos una carpeta con el nombre que queramos, por ejemplo <code>odoo-compose</code>.</li>
<li>Dentro de esta carpeta creamos un archivo llamado <strong>docker-compose.yml</strong> con el contenido descrito anteriormente.</li>
<li>Desde el terminal, nos ubicamos en la carpeta comentada y solo hay que ejecutar cada vez:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<p>En el caso definido en el fichero de configuración <strong>docker-compose.yml</strong>, necesitamos un archivo <code>odoo.conf</code> que podemos extraer de un contenedor sin el volumen de <code>./config</code>.</p>
<p>Este fichero de configuración por defecto, lo podemos obtener por internet, o seguimos los siguientes pasos donde creamos un docker con odoo, le extraemos el fichero de configuración y lo paramos y eliminamos:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>odoo-temp<span class="w"> </span>odoo:18.0
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>docker<span class="w"> </span>cp<span class="w"> </span>odoo-temp:/etc/odoo/odoo.conf<span class="w"> </span>./config/odoo.conf
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>docker<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>odoo-temp
</span></code></pre></div>
<p>Veamos la secuencia de creación del sistema y copia del fichero de configuración por defecto:</p>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/docker-conf.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/docker-conf.png" width="75%" /></a>
  <figcaption>Obtención de fichero de configuración odoo.conf.</figcaption>
</figure>
<p>Hemos asociado un volumen a las carpetas de los dos contenedores y por otra parte tenemos en la carpeta del docker compose los directorios <code>config</code> y <code>addons</code>. Esto permite compartir el código y la configuración de <strong><em>Odoo</em></strong> sin compartir demasiados archivos o los datos privados de la base de datos. Para compartir solo hay que comprimir o subir a <code>Git</code> la carpeta contenedora de los archivos y carpetas que estamos creando.</p>
<p>Si queremos entrar en la base de datos PostgreSQL para hacer cosas manualmente, podemos ejecutar:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>postgresql<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>odoo<span class="w"> </span>-d<span class="w"> </span>postgres
</span></code></pre></div>
<p>Ejecutamos el comando <strong><em>psql</em></strong> de forma interactiva en la base de datos <code>postgres</code> y con el usuario <code>odoo</code>.</p>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/comprueba-postgres.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/comprueba-postgres.png" width="95%" /></a>
  <figcaption>Verificando que la base de datos esta en marcha.</figcaption>
</figure>
<p>En ocasiones es interesante revisar <strong>logs</strong> por si tenemos algún problema. Para ver los <strong>logs</strong> podemos hacer si no estamos <em>attached</em> con la ejecución del docker, también podemos hacer :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>docker<span class="w"> </span>logs<span class="w"> </span>odoo<span class="w"> </span>-f
</span></code></pre></div>
<p>Con este comando filtramos solo los mensajes de <em>logs</em> de <em>odoo</em>. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Los logs se ven en color gracias a poner <code>tty:true</code> en el archivo de configuración.</p>
</div>
<h3 id="activando-odoo-en-modo-desarrollador">Activando <code>Odoo</code> en Modo desarrollador</h3>
<p>Como se puede ver, hemos configurado un directorio para los módulos en <code>./addons</code>. En este directorio haremos los <code>scaffold</code>. </p>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Un <strong>scaffold</strong> es una herramienta que te permite generar automáticamente la estructura básica de un módulo personalizado. Es como un "esqueleto" inicial que incluye todos los archivos y carpetas necesarios para empezar a desarrollar un módulo</p>
</div>
<p>Además, hemos añadido al comando <code>--dev=all</code> a la ejecución de <code>docker</code>. Esto simplifica mucho el desarrollo, ya que muchos de los cambios provocan un reinicio del servidor y actualización de algunas partes de los módulos.</p>
<p>La opción <code>--dev &lt;feature,feature,...,feature&gt;</code> en Odoo permite activar varias características útiles para el desarrollo. <strong>Esta opción no debe usarse en producción</strong>, ya que está pensada exclusivamente para facilitar la tarea de los desarrolladores. A continuación, se explican las opciones disponibles:</p>
<ul>
<li><strong>all</strong>: Activa todas las funcionalidades de desarrollo descritas a continuación.</li>
<li><strong>xml</strong>: Carga las plantillas <em>QWeb</em> directamente desde los archivos XML en lugar de la base de datos. Si una plantilla se modifica en la base de datos, no se volverá a cargar desde el archivo XML hasta la próxima actualización o reinicio. Además, las plantillas no se traducen cuando se usa esta opción.</li>
<li><strong>reload</strong>: Reinicia el servidor automáticamente cuando se detecta un cambio en un archivo Python.</li>
<li><strong>qweb</strong>: Permite interrumpir la ejecución de una plantilla <em>QWeb</em> si un nodo contiene <code>t-debug="debugger"</code>, lo que facilita la depuración.</li>
<li><strong>(i)p(u)db</strong>: Activa un depurador de Python (como <code>pdb</code>, <code>ipdb</code> o <code>pudb</code>) cuando se produce un error inesperado, antes de registrarlo en los logs y devolverlo.</li>
<li><strong>werkzeug</strong>: Muestra la traza completa del error en la página web cuando se produce una excepción, algo muy útil para identificar problemas en el código.</li>
</ul>
<p>Esta opción es muy útil durante el desarrollo, ya que facilita la depuración de código, la recarga en caliente de archivos y la revisión de errores de manera más visual. </p>
<p>Sin embargo, está limitada en ciertos aspectos. Por ejemplo, vuelve a ejecutar el Python pero no crea nuevos modelos o campos. Tampoco actualiza todos los XML, solo el contenido de las vistas en <code>ir.ui.view</code> que ya se han registrado actualizando el módulo. Por tanto, no siempre sirve y menos en las etapas iniciales de la creación de módulos.</p>
<p>Como el comando con <code>--dev=all</code> no actualiza la base de datos, la creación de nuevas vistas, nuevos modelos o campos no se actualizará y dará errores. Una solución es añadir al comando:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;--dev=all&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-u&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;modulo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-d&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;basededatos&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<p>Pero solo cuando ya existe la base de datos y el módulo está instalado. En caso de arrancar docker con este comando por primera vez, se creará la base de datos con una configuración estándar que no nos interesa, en inglés, sin datos de demo y con usuario/contraseña admin/admin.</p>
<p>Además, solo se ejecutará cuando arranquemos Docker, por lo tanto, hay que hacer un <code>docker-compose down</code> y volver a arrancar los contenedores de nuevo. </p>
<div class="admonition tip">
<p class="admonition-title">Configuración de VSCode</p>
<p>Para no tener que estar reiniciando <code>docker</code> desde la línea de comando, podemos añadir a <code>Visual Studio Code</code> una extensión como <strong>VS Code Action Buttons</strong>. Una vez instalada esta extensión, vamos la configuración de la extensión y completamos el <code>json</code>  de configuración así:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nt">&quot;commands&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">     </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$(triangle-right) Run Odoo&quot;</span><span class="p">,</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">     </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">     </span><span class="nt">&quot;singleInstance&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">     </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker-compose down &amp;&amp; docker-compose up -d &amp;&amp; docker logs odoo -f&quot;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">},</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">{</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">     </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$(triangle-right) Rerun Odoo&quot;</span><span class="p">,</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">     </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">     </span><span class="nt">&quot;singleInstance&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">     </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker-compose restart odoo &amp;&amp; docker logs odoo -f&quot;</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="p">],</span>
</span></code></pre></div>
<p>El primer comando lo reinicia todo, tanto la base de datos como Odoo y elimina los contenedores para recrearlos. </p>
<p>Esto puede solucionar algunos problemas. Pero en principio, el segundo reinicia solo el contenedor Odoo sin recrearlo. Es más rápido y también actualiza la base de datos. El comando se puede utilizar en una terminal si no queremos hacer los botones o estamos en un entorno sin interfaz gráfica.</p>
</div>
<h3 id="creacion-de-un-nuevo-modulo">Creación de un nuevo módulo</h3>
<p>Uno de nuestros objetivos en el curso será el de dotar de nuevas funcionalidades personalizadas a el ERP base que ofrece <em>Odoo</em>, por lo tanto deberemos aprender a crear nuevos módulos.</p>
<p>Veamos de forma sencilla cómo crear módulos nuevos y posteriormente profundizaremos durante el curso:</p>
<p>Para crear un móudulo ejecutamos hacemos un <strong>scaffold</strong> que hemos comentado antes, damos un nombre al módulo (en este caso <em>pruebas</em>) y le decimos que los vamos a ubicar en la carpeta <code>extra-addons</code> del contenedor que se encuentra redireccionada a la carpeta <code>./addons</code> que tenemos en la uticación del <em>docker-compose</em></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>odoo<span class="w"> </span>odoo<span class="w"> </span>scaffold<span class="w"> </span>pruebas<span class="w"> </span>/mnt/extra-addons
</span></code></pre></div>
<p>Posteriormente es aconsejable dar permisos para poder acceder a esta carpeta. Debemos tener en cuenta siempre los permisos para que tanto el proceso <em>docker</em> que se ejecuta como <code>root</code> como nosotros con nuestro usuario podemos acceder a la carpeta.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>odoo<span class="w"> </span>chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>-R<span class="w"> </span>/mnt/extra-addons/pruebas
</span></code></pre></div>
<p>y podemos comprobar como se ha creado una carpeta <code>pruebas</code> que contiene la estructura de nuestro nuevo módulo</p>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/scaffold-pruebas.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/scaffold-pruebas.png" width="75%" /></a>
  <figcaption>Creación de módulo de pruebas.</figcaption>
</figure>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Si queremos ejecutar el <code>shell</code> de <em>Odoo</em> podemos ejecutar el comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>odoo<span class="w"> </span>odoo<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>pruebas<span class="w"> </span>--db_host<span class="w"> </span>db<span class="w"> </span>--db_password<span class="w"> </span>odoo
</span></code></pre></div>
<p>Aquí estamos diciendo que ejecute en el contenedor odoo el comando odoo especificando la base de datos y el host y password de postgres. Es necesario especificar la base de datos porque Docker Compose crea múltiples contenedores Docker basándose en la configuración del archivo <code>docker-compose.yml</code>. En este caso, hay varios contenedores en ejecución, uno que corre <strong>Odoo</strong>, otro que corre <strong>PostgreSQL</strong>, y posiblemente otros más.</p>
</div>
<p>Por último, debemos tener en cuenta que cada contenedor es una máquina virtual separada con su propia dirección IP, por lo que si ejecutas este comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>odoo_odoo_1<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;odoo shell -d postgres&quot;</span>
</span></code></pre></div>
<p>Odoo intentará conectarse a la base de datos <strong>usando <code>localhost</code></strong>, pero en este contexto, <code>localhost</code> se refiere al propio contenedor de Odoo, no al de PostgreSQL.</p>
<p>Para solucionarlo, debes indicar explícitamente el <strong>host de la base de datos</strong> y la <strong>contraseña</strong> en el comando.</p>
<p>Para ello, podemos ejecutar el siguiente comando <em>docker</em> que nos lista las IP de los contenedores que tenemos activos.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="w"> </span><span class="s1">&#39;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span>
</span></code></pre></div>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/docker-listadoIPs.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/docker-listadoIPs.png" width="95%" /></a>
  <figcaption>Listando IPs de contenedores activos.</figcaption>
</figure>
<h2 id="poner-en-produccion-con-docker">Poner en producción con Docker</h2>
<p>Si podemos dejar corriendo un Docker en un servidor con conexión a Internet y los puertos expuestos, ya estaría en producción. Sin embargo, esto supone varios problemas de seguridad y rendimiento.</p>
<h3 id="docker-de-nginx">Docker de Nginx</h3>
<p>Podemos añadir al archivo de Docker Compose la configuración de un contenedor <em>Nginx</em>. Este implementará HTTPS y hará de proxy a Odoo.</p>
<div class="admonition nginx">
<p class="admonition-title">Nginx</p>
<p>Un servidor <strong><em>Nginx</em></strong> (pronunciado "engine-x") es un software de servidor web de alto rendimiento que también puede funcionar como:</p>
<ul>
<li>Servidor proxy inverso</li>
<li>Balanceador de carga</li>
<li>Servidor de correo (limitado)</li>
<li>Proxy para protocolos como HTTP, HTTPS, SMTP, POP3 y IMAP</li>
</ul>
</div>
<p>Usaremos un archivo <em>Dockerfile</em> basado en la imagen oficial de <em>Nginx</em>, pero adaptada a nuestras necesidades. Los certificados se generan de manera automática y están autofirmados.</p>
<p>Aunque los navegadores muestran un aviso de error, la información sigue viajando de forma segura. Lo que ocurre es que no hay ninguna autoridad certificadora que haya validado el certificado (no es lo mismo un certificado autofirmado que ninguna protección).</p>
<p>Se podría hacer un script con <em>CertBot</em> para utilizar <em>Let's Encrypt</em> y renovar el certificado cada tres meses.</p>
<p>En <em>Nginx</em>, definimos la misma carpeta para HTTP y HTTPS, intentando simplificar al máximo la configuración y automatizar la creación tanto de la imagen como del contenedor con scripts.</p>
<p>El primer paso es crear nuestra clave y certificado autofirmado dentro de un directorio <em>nginx</em> junto al resto de archivos de los dockers:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>mkdir<span class="w"> </span>nginx
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nb">cd</span><span class="w"> </span>nginx
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-sha256<span class="w"> </span>-nodes<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>ser.key<span class="w"> </span>-out<span class="w"> </span>ser.pem
</span></code></pre></div>
<p>Después creamos un <code>Dockerfile</code> dentro de la misma carpeta. Este archivo servirá para ejecutar ciertos comandos cada vez que se lance el docker:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">RUN</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/nginx/conf.d/default.conf
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">COPY</span><span class="w"> </span>nginx.conf<span class="w"> </span>/etc/nginx/conf.d/
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="k">COPY</span><span class="w"> </span>ser.key<span class="w"> </span>/etc/nginx/
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="k">COPY</span><span class="w"> </span>ser.pem<span class="w"> </span>/etc/nginx/
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80 443</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Añadiremos al <code>docker-compose.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span><span class="w">  </span><span class="c1"># este campo es opcional si el archivo se llama así</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odoo</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:443&quot;</span>
</span></code></pre></div>
<p>Falta crear el <code>nginx.conf</code> que será la configuración:</p>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># odoo server</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">upstream</span><span class="w"> </span><span class="s">odoo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span><span class="kn">server</span><span class="w"> </span><span class="n">odoo</span><span class="p">:</span><span class="mi">8069</span><span class="p">;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="p">}</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="k">upstream</span><span class="w"> </span><span class="s">odoochat</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">  </span><span class="kn">server</span><span class="w"> </span><span class="n">odoo</span><span class="p">:</span><span class="mi">8072</span><span class="p">;</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="p">}</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1"># Se han definido los upstream a localhost y a los puertos determinados</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="c1"># http -&gt; https (todas las peticiones por HTTP se redirigen a HTTPS)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">   </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">   </span><span class="kn">server_name</span><span class="w"> </span><span class="s">_</span><span class="p">;</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">   </span><span class="c1"># Si tuviéramos nombre de dominio lo pondríamos, en otro caso: _</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">   </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^(.*)</span><span class="w"> </span><span class="s">https://</span><span class="nv">$host$1</span><span class="w"> </span><span class="s">permanent</span><span class="p">;</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="p">}</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">  </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="p">;</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">  </span><span class="kn">server_name</span><span class="w"> </span><span class="s">_</span><span class="p">;</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w">  </span><span class="c1"># La _ porque en el ejemplo no tenemos dominio, como arriba</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">  </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="s">720s</span><span class="p">;</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">  </span><span class="kn">proxy_connect_timeout</span><span class="w"> </span><span class="s">720s</span><span class="p">;</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w">  </span><span class="kn">proxy_send_timeout</span><span class="w"> </span><span class="s">720s</span><span class="p">;</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">  </span><span class="c1"># Add Headers for odoo proxy mode</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">  </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w">  </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">  </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">  </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w">  </span><span class="c1"># SSL parameters</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w">  </span><span class="kn">ssl_certificate</span><span class="w"> </span><span class="s">/etc/nginx/ser.pem</span><span class="p">;</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">  </span><span class="kn">ssl_certificate_key</span><span class="w"> </span><span class="s">/etc/nginx/ser.key</span><span class="p">;</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="w">  </span><span class="c1"># IMPORTANTE: poner bien las rutas de los certificados</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="w">  </span><span class="kn">ssl_session_timeout</span><span class="w"> </span><span class="mi">30m</span><span class="p">;</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w">  </span><span class="kn">ssl_protocols</span><span class="w"> </span><span class="s">TLSv1</span><span class="w"> </span><span class="s">TLSv1.1</span><span class="w"> </span><span class="s">TLSv1.2</span><span class="p">;</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w">  </span><span class="kn">ssl_ciphers</span><span class="w"> </span><span class="s">&#39;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA&#39;</span><span class="p">;</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w">  </span><span class="kn">ssl_prefer_server_ciphers</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w">  </span><span class="c1"># log</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w">  </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/odoo.access.log</span><span class="p">;</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">  </span><span class="kn">error_log</span><span class="w"> </span><span class="s">/var/log/nginx/odoo.error.log</span><span class="p">;</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w">  </span><span class="c1"># Redirect requests to odoo backend server</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w">    </span><span class="kn">proxy_redirect</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://odoo</span><span class="p">;</span>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="s">/longpolling</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a><span class="w">      </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://odoochat</span><span class="p">;</span>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="w">  </span><span class="c1"># common gzip</span>
</span><span id="__span-30-55"><a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="w">  </span><span class="kn">gzip_types</span><span class="w"> </span><span class="s">text/css</span><span class="w"> </span><span class="s">text/less</span><span class="w"> </span><span class="s">text/plain</span><span class="w"> </span><span class="s">text/xml</span><span class="w"> </span><span class="s">application/xml</span><span class="w"> </span><span class="s">application/json</span><span class="w"> </span><span class="s">application/javascript</span><span class="p">;</span>
</span><span id="__span-30-56"><a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="w">  </span><span class="kn">gzip</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
</span><span id="__span-30-57"><a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="workers">Workers</h3>
<p>Por defecto, Odoo es <code>multithread</code>. Esto significa que puede mantener varios hilos de ejecución. Sin embargo, es algo ineficiente en producción si tienes muchos usuarios. Es mejor, además, que sea <code>multi-processing</code> para poder distribuir la carga entre distintos procesadores o núcleos (no disponible en Windows).</p>
<p>Para conseguirlo, solo hay que indicar en el archivo de configuración odoo.conf</p>
<figure align="center">
  <a class="glightbox" href="../imgs/instalacion/odoo-config.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/instalacion/odoo-config.png" width="60%" /></a>
  <figcaption>Edición del fichero de configuración de Odoo.</figcaption>
</figure>
<p>Añadiremos al final la cantidad de <code>workers</code> que queremos, además de otros parámetros:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p p-Indicator">[</span><span class="nv">options</span><span class="p p-Indicator">]</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="l l-Scalar l-Scalar-Plain">limit_memory_hard = 1677721600</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="l l-Scalar l-Scalar-Plain">limit_memory_soft = 629145600</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="l l-Scalar l-Scalar-Plain">limit_request = 8192</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="l l-Scalar l-Scalar-Plain">limit_time_cpu = 600</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="l l-Scalar l-Scalar-Plain">limit_time_real = 1200</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="l l-Scalar l-Scalar-Plain">max_cron_threads = 1</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="l l-Scalar l-Scalar-Plain">workers = 8</span>
</span></code></pre></div>
<p>Como regla aproximada, se pueden calcular los workers óptimos como 1 worker por cada 6 usuarios simultáneos y el doble + 1 de workers por CPU. Así, si tenemos un servidor con 4 núcleos, 8 threads y unos 60 usuarios simultáneos:</p>
<ul>
<li>60/6 ≈ 10 workers</li>
<li>4*2+1 = 9 workers que soporta la máquina</li>
<li>En este caso, se pueden utilizar 8 workers + 1 para el cron</li>
<li>La RAM, de forma simple, se puede estimar en 1GB por worker. Sin embargo, hay peticiones que no necesitan más de 150MB. Según la documentación de Odoo, para 9 workers: 9 * ((0.8<em>150) + (0.2</em>1024)) ≈ 3GB de RAM mínimo.</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.instant", "navigation.instant.progress", "toc.follow", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>